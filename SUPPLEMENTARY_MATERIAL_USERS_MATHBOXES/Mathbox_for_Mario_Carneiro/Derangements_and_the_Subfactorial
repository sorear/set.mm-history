$(
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                      Derangements and the Subfactorial
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
$)

  ${
    $d f g h m n s x y z A $.  $d b c f g x y F $.  $d c f g h k m n x y z N $.
    $d b k m n $.  $d b c f g h s x y z B $.  $d b c x y C $.  $d b c x y ph $.
    $d n D $.  $d c f n x y K $.  $d b f g x y M $.  $d m n x y S $.  $d f V $.
    $( Lemma for derangements. $)
    deranglem $p |- ( A e. Fin ->
      { f | ( f : A -1-1-onto-> A /\ ph ) } e. Fin ) $=
      ( cfn wcel cv wf1o wa cab cmap co wss mapfi wf f1of adantr elmapg syl5ibr
      abssdv ssfi syl2anc anidms ) BDEZBBCFZGZAHZCIZDEZUCUCHZBBJKZDEUGUJLUHBBMU
      IUFCUJUFUDUJEUIBBUDNZUEUKABBUDOPBBUDDDQRSUJUGTUAUB $.
      $( [19-Jan-2015] $)

    derang.d $e |- D = ( x e. Fin |-> ( # ` { f | ( f : x -1-1-onto-> x /\
      A. y e. x ( f ` y ) =/= y ) } ) ) $.
    $( Define the derangement function, which counts the number of bijections
       from a set to itself such that no element is mapped to itself. $)
    derangval $p |- ( A e. Fin -> ( D ` A ) =
      ( # ` { f | ( f : A -1-1-onto-> A /\ A. y e. A ( f ` y ) =/= y ) } ) ) $=
      ( cv wf1o cfv wne wral wa cab chash cfn wceq f1oeq2 f1oeq3 bitrd raleq
      anbi12d abbidv fveq2d fvex fvmpt ) ACAGZUFEGZHZBGZUGIUIJZBUFKZLZEMZNICCUG
      HZUJBCKZLZEMZNIODUFCPZUMUQNURULUPEURUHUNUKUOURUHCUFUGHUNUFCUFUGQUFCCUGRSU
      JBUFCTUAUBUCFUQNUDUE $.
      $( [19-Jan-2015] $)

    $( The derangement number is a function from finite sets to nonnegative
       integers. $)
    derangf $p |- D : Fin --> NN0 $=
      ( cv wf1o cfv wne wral wa cab chash cn0 wcel cfn wf deranglem hashcl syl
      rgen fmpt mpbi ) AFZUDDFZGBFZUEHUFIBUDJZKDLZMHZNOZAPJPNCQUJAPUDPOUHPOUJUG
      UDDRUHSTUAAPNUICEUBUC $.
      $( [19-Jan-2015] $)

    $( The derangement number of the empty set. $)
    derang0 $p |- ( D ` (/) ) = 1 $=
      ( c0 cfv cv wf1o wne wral wa cab chash csn c1 wcel wceq ax-mp cvv biantru
      cfn 0fin derangval ral0 eqid f1o00 mpbiran2 bitr3i abbii df-sn eqtr4i 0ex
      fveq2i hashsng 3eqtri ) FCGZFFDHZIZBHZURGUTJZBFKZLZDMZNGZFOZNGZPFUBQUQVER
      UCABFCDEUDSVDVFNVDURFRZDMVFVCVHDVCUSVHVBUSVABUEUAUSVHFFRFUFFURUGUHUIUJDFU
      KULUNFTQVGPRUMFTUOSUP $.
      $( [19-Jan-2015] $)

    $( The derangement number of a singleton. $)
    derangsn $p |- ( A e. V -> ( D ` { A } ) = 0 ) $=
      ( wcel csn cfv c0 chash cc0 cv wf1o wne wral wa wceq syl cab cfn snfi wss
      derangval ax-mp wf adantr snidg ffvelrn syl2anr wn simpr fveq2 id neeq12d
      rcla4va syl2an elsni necon3ai pm2.65i pm2.21i ex abssdv ss0 fveq2d syl5eq
      f1of hash0 syl6eq ) CFHZCIZDJZKLJZMVKVMVLVLENZOZBNZVOJZVQPZBVLQZRZEUAZLJZ
      VNVLUBHVMWCSCUCABVLDEGUEUFVKWBKLVKWBKUDWBKSVKWAEKVKWAVOKHZVKWARZWDWECVOJZ
      VLHZWAVLVLVOUGZCVLHZWGVKVPWHVTVLVLVOVHUHCFUIZVLVLCVOUJUKWEWFCPZWGULVKWIVT
      WKWAWJVPVTUMVSWKBCVLVQCSZVRWFVQCVQCVOUNWLUOUPUQURWGWFCWFCUSUTTVAVBVCVDWBV
      ETVFVGVIVJ $.
      $( [19-Jan-2015] $)

    $( One half of ~ derangen . $)
    derangenlem $p |- ( ( A ~~ B /\ B e. Fin ) -> ( D ` A ) <_ ( D ` B ) ) $=
      ( vs cfn wcel wa cv wf1o cfv wne wral ccom wf wceq f1of vg vh cen wbr cab
      vz chash cle cdom simpr wb enfi ancoms mpbird deranglem syl breng biimpac
      wi ccnv f1oco ad2ant2lr f1ocnv ad2antlr syl2anc coass fveq1i simprl fvco3
      wex sylan syl5eq ffvelrn simplrr fveq2 neeq12d rcla4v sylc eqnetrd necomd
      id simpllr f1ocnvfv necon3d mpd ralrimiva cbvralv sylib jca ex vex f1oeq1
      fveq1 neeq1d ralbidv anbi12d elab coex cnvex 3imtr4g anbi12i coeq1 coeq2d
      cid cres simplr f1ococnv1 adantrr fcoi1 3syl eqtrd coeq1d syl5eqr simprll
      fcoi2 3eqtrd simprrl eqeq12d syl5ib impbid1 syl5bi exlimdv adantl hashdom
      coeq2 dom2d derangval 3brtr4d ) CDUCUDZDIJZKZCCFLZMZBLZYLNZYNOZBCPZKZFUEZ
      UGNZDDYLMZYPBDPZKZFUEZUGNZCENZDENZUHYKYTUUEUHUDZYSUUDUIUDZYKYSIJZUUIYKCIJ
      ZUUJYKUUKYJYIYJUJYJYIUUKYJUKCDIULUMUNZYQCFUOUPZYKCDHLZMZHVJZUUJUUIUSZYJYI
      UUPCDIHUQURYKUUOUUQHYKUUOUUQYKUUOKZUAUBYSUUDUUNUALZQZUUNUTZQZUUNUBLZQZUVA
      QZIUURCCUUSMZYNUUSNZYNOZBCPZKZDDUVBMZYNUVBNZYNOZBDPZKZUUSYSJZUVBUUDJUURUV
      JUVOUURUVJKZUVKUVNUVQCDUUTMZDCUVAMZUVKUUOUVFUVRYKUVICCDUUNUUSVAVBZUUOUVSY
      KUVJCDUUNVCVDZDCDUUTUVAVAVEUVQUFLZUVBNZUWBOZUFDPUVNUVQUWDUFDUVQUWBDJZKZUW
      CUWBUUSUVAQZNZUUNNZUWBUWFUWCUWBUUNUWGQZNZUWIUWBUVBUWJUUNUUSUVAVFVGUVQDCUW
      GRZUWEUWKUWISUVQDCUWGMZUWLUVQUVFUVSUWMUURUVFUVIVHUWADCCUUSUVAVAVEDCUWGTUP
      ZDCUWBUUNUWGVIVKVLUWFUWBUVANZUWHOUWIUWBOUWFUWHUWOUWFUWHUWOUUSNZUWOUVQDCUV
      ARZUWEUWHUWPSUVQUVSUWQUWADCUVATUPZDCUWBUUSUVAVIVKUWFUWOCJZUVIUWPUWOOZUVQU
      WQUWEUWSUWRDCUWBUVAVMVKUURUVFUVIUWEVNUVHUWTBUWOCYNUWOSZUVGUWPYNUWOYNUWOUU
      SVOUXAWAVPVQVRVSVTUWFUWIUWBUWOUWHUWFUUOUWHCJZUWIUWBSUWOUWHSUSYKUUOUVJUWEW
      BUVQUWLUWEUXBUWNDCUWBUWGVMVKCDUWHUWBUUNWCVEWDWEVSWFUWDUVMUFBDUWBYNSZUWCUV
      LUWBYNUWBYNUVBVOUXCWAVPWGWHWIWJYRUVJFUUSUAWKZYLUUSSZYMUVFYQUVICCYLUUSWLUX
      EYPUVHBCUXEYOUVGYNYNYLUUSWMWNWOWPWQZUUCUVOFUVBUUTUVAUUNUUSHWKZUXDWRUUNUXG
      WSWRYLUVBSZUUAUVKUUBUVNDDYLUVBWLUXHYPUVMBDUXHYOUVLYNYNYLUVBWMWNWOWPWQWTUV
      PUVCYSJZKUVJCCUVCMZYNUVCNZYNOZBCPZKZKZUURUVBUVESZUUSUVCSZUKZUVPUVJUXIUXNU
      XFYRUXNFUVCUBWKYLUVCSZYMUXJYQUXMCCYLUVCWLUXSYPUXLBCUXSYOUXKYNYNYLUVCWMWNW
      OWPWQXAUURUXOUXRUURUXOKZUXPUXQUXPUVAUVBUUNQZQZUVAUVEUUNQZQZSUXTUXQUXPUYAU
      YCUVAUVBUVEUUNXBXCUXTUYBUUSUYDUVCUXTUYBUVAUUTQZXDCXEZUUSQZUUSUXTUYAUUTUVA
      UXTUYAUUTUVAUUNQZQZUUTUUTUVAUUNVFUXTUYIUUTUYFQZUUTUXTUYHUYFUUTUXTUUOUYHUY
      FSYKUUOUXOXFZCDUUNXGUPZXCUXTUVRCDUUTRUYJUUTSUURUVJUVRUXNUVTXHCDUUTTCDUUTX
      IXJXKVLXCUXTUYEUYHUUSQUYGUVAUUNUUSVFUXTUYHUYFUUSUYLXLXMUXTUVFCCUUSRUYGUUS
      SUURUVFUVIUXNXNCCUUSTCCUUSXOXJXPUXTUYDUVAUVDQZUYFUVCQZUVCUXTUYCUVDUVAUXTU
      YCUVDUYHQZUVDUVDUVAUUNVFUXTUYOUVDUYFQZUVDUXTUYHUYFUVDUYLXCUXTCDUVDMZCDUVD
      RUYPUVDSUXTUUOUXJUYQUYKUURUVJUXJUXMXQZCCDUUNUVCVAVECDUVDTCDUVDXIXJXKVLXCU
      XTUYMUYHUVCQUYNUVAUUNUVCVFUXTUYHUYFUVCUYLXLXMUXTUXJCCUVCRUYNUVCSUYRCCUVCT
      CCUVCXOXJXPXRXSUXQUUTUVDUVAUUSUVCUUNYEXLXTWJYAYFWJYBWEWEYKUUJUUDIJZUUHUUI
      UKUUMYJUYSYIUUBDFUOYCYSUUDYDVEUNYKUUKUUFYTSUULABCEFGYGUPYJUUGUUESYIABDEFG
      YGYCYH $.
      $( [22-Jan-2015] $)

    $( The derangement number is a cardinal invariant, i.e. it only depends on
       the size of a set and not on its contents. $)
    derangen $p |- ( ( A ~~ B /\ B e. Fin ) -> ( D ` A ) = ( D ` B ) ) $=
      ( cen wbr cfn wcel wa cfv cle derangenlem wb syl2anc cn0 ffvelrni cr wceq
      ensymg impcom simpr enfi ancoms mpbird derangf adantl nn0re letri3 syl2an
      syl mpbir2and ) CDHIZDJKZLZCEMZDEMZUAZURUSNIZUSURNIZABCDEFGOUQDCHIZCJKZVB
      UPUOVCCDJUBUCUQVDUPUOUPUDUPUOVDUPPCDJUEUFUGZABDCEFGOQUQURRKZUSRKZUTVAVBLP
      ZUQVDVFVEJRCEABEFGUHZSUMUPVGUOJRDEVISUIVFURTKUSTKVHVGURUJUSUJURUSUKULQUN
      $.
      $( [22-Jan-2015] $)

    subfac.n $e |- S = ( n e. NN0 |-> ( D ` ( 1 ... n ) ) ) $.
    $( The subfactorial is defined as the number of derangements (see
       ~ derangval ) of the set ` ( 1 ... N ) ` . $)
    subfacval $p |- ( N e. NN0 -> ( S ` N ) = ( D ` ( 1 ... N ) ) ) $=
      ( c1 cv cfz co cfv cn0 wceq oveq2 fveq2d fvex fvmpt ) FGJFKZLMZCNJGLMZCNO
      DUAGPUBUCCUAGJLQRIUCCST $.
      $( [21-Jan-2015] $)

    $( Write the derangement number in terms of the subfactorial. $)
    derangen2 $p |- ( A e. Fin -> ( D ` A ) = ( S ` ( # ` A ) ) ) $=
      ( cfn wcel chash cfv c1 cfz co cn0 wceq syl mpancom subfacval cen hashfz1
      hashcl wbr wb fzfid hashen mpbid derangen eqtr2d ) CJKZCLMZEMZNUMOPZDMZCD
      MZULUMQKZUNUPRCUDZABDEFGUMHIUASUOCUBUEZULUPUQRULUOLMUMRZUTULURVAUSUMUCSUO
      JKULVAUTUFULNUMUGUOCUHTUIABUOCDFHUJTUK $.
      $( [22-Jan-2015] $)

    $( The subfactorial is a function from nonnegative integers to nonnegative
       integers. $)
    subfacf $p |- S : NN0 --> NN0 $=
      ( c1 cv cfz co cfv cn0 wcel wral wf cfn fzfi derangf ffvelrni ax-mp rgenw
      fmpt mpbi ) IFJZKLZCMZNOZFNPNNDQUIFNUGROUIIUFSRNUGCABCEGTUAUBUCFNNUHDHUDU
      E $.
      $( [19-Jan-2015] $)

    $( The subfactorial is less than the factorial. $)
    subfaclefac $p |- ( N e. NN0 -> ( S ` N ) <_ ( ! ` N ) ) $=
      ( wcel c1 cv cfv wa cab chash cfa cle cfn syl cn0 cfz co wf1o wne wbr wss
      wral cdom fzfid deranglem simpl ss2abi ssdomg ee10 wb anidm abbii hashdom
      syl5eqelr syl2anc mpbird subfacval derangval eqtrd hashfac hashfz1 fveq2d
      wceq eqtr2d 3brtr4d ) GUAJZKGUBUCZVMELZUDZBLZVNMVPUEBVMUHZNZEOZPMZVOEOZPM
      ZGDMZGQMZRVLVTWBRUFZVSWAUIUFZVLVSSJZVSWAUGWFVLVMSJZWGVLKGUJZVQVMEUKTZVRVO
      EVOVQULUMVSWASUNUOVLWGWASJWEWFUPWJVLWAVOVONZEOZSWKVOEVOUQURVLWHWLSJWIVOVM
      EUKTUTVSWAUSVAVBVLWCVMCMZVTABCDEFGHIVCVLWHWMVTVIWIABVMCEHVDTVEVLWBVMPMZQM
      ZWDVLWHWBWOVIWIVMEVFTVLWNGQGVGVHVJVK $.
      $( [19-Jan-2015] $)

    $( The subfactorial at zero. $)
    subfac0 $p |- ( S ` 0 ) = 1 $=
      ( cc0 cfv c1 cfz co c0 cn0 wcel wceq 0nn0 subfacval ax-mp fveq2i derang0
      fz10 3eqtri ) IDJZKILMZCJZNCJKIOPUEUGQRABCDEFIGHSTUFNCUCUAABCEGUBUD $.
      $( [19-Jan-2015] $)

    $( The subfactorial at one. $)
    subfac1 $p |- ( S ` 1 ) = 0 $=
      ( c1 cfv cfz co csn cc0 cn0 wcel wceq 1nn0 subfacval ax-mp cz fzsn fveq2i
      1z derangsn 3eqtri ) IDJZIIKLZCJZIMZCJZNIOPZUGUIQRABCDEFIGHSTUHUJCIUAPUHU
      JQUDIUBTUCULUKNQRABICEOGUETUF $.
      $( [19-Jan-2015] $)

    ${
      subfacp1lem.a $e |- A = { f |
        ( f : ( 1 ... ( N + 1 ) ) -1-1-onto-> ( 1 ... ( N + 1 ) ) /\
          A. y e. ( 1 ... ( N + 1 ) ) ( f ` y ) =/= y ) } $.
      ${
        subfacp1lem1.n $e |- ( ph -> N e. NN ) $.
        subfacp1lem1.m $e |- ( ph -> M e. ( 2 ... ( N + 1 ) ) ) $.
        subfacp1lem1.x $e |- M e. _V $.
        subfacp1lem1.k $e |- K = ( ( 2 ... ( N + 1 ) ) \ { M } ) $.
        $( Lemma for ~ subfacp1 .  The set ` K ` together with ` { 1 , M } `
           partitions the set ` 1 ... ( N + 1 ) ` . $)
        subfacp1lem1 $p |- ( ph ->
          ( ( K i^i { 1 , M } ) = (/) /\
            ( K u. { 1 , M } ) = ( 1 ... ( N + 1 ) ) /\
            ( # ` K ) = ( N - 1 ) ) ) $=
          ( c1 wcel cpr cin c0 wceq cun caddc co cfz chash cfv cmin cv wral wne
          wn wo wa csn cdif eldifi cle wbr elfzle1 clt 1lt2 1re 2re ltnlei mpbi
          c2 breq2 mtbiri necon2ai syl eldifsn simprbi jca eleq2s neanior sylib
          vex elpr sylnibr rgen disj mpbir a1i cz 1z ax-mp uneq1i undif1 eqtr2i
          fzsn uneq12i unass uncom df-pr eqtri uneq2i 3eqtr4i wss snssd ssequn2
          oveq1i syl6eq uneq2d cn peano2nn cuz syl6eleq eluzfz1 fzsplit syl2anc
          df-2 nnuz eqtr4d syl5eqr oveq2i fveq2d fzfi diffi eqeltri prfi hashun
          cfn mp3an neeq1 vtoclga necomd cr elexi hashpr oveq2d syl5eq nnnn0 cc
          cn0 nncn syl3anc hashfz1 3syl 3eqtr3d recni idi hashcl nn0cni subadd2
          wb mpbird ax-1cn pnpcan2 eqtr3d 3jca ) AISJUAZUBUCUDZIUUOUEZSKSUFUGZU
          HUGZUDIUIUJZKSUKUGZUDUUPAUUPBULZUUOTZUOZBIUMUVDBIUVBITZUVBSUDZUVBJUDU
          PZUVCUVEUVBSUNZUVBJUNZUQZUVGUOUVJUVBVJUURUHUGZJURZUSZIUVBUVMTZUVHUVIU
          VNUVBUVKTZUVHUVBUVKUVLUTUVOVJUVBVAVBZUVHUVBVJUURVCUVPUVBSUVFUVPVJSVAV
          BZSVJVDVBUVQUOVESVJVFVGVHVIUVBSVJVAVKVLVMVNZVNUVNUVOUVIUVBUVKJVOVPVQR
          VRUVBSUVBJVSVTUVBSJBWAWBWCWDBIUUOWEWFZWGAUUQSSUHUGZUVKUVLUEZUEZUUSUWB
          SURZIUVLUEZUEZUUQUVTUWCUWAUWDSWHTUVTUWCUDWISWNWJUWDUVMUVLUEUWAIUVMUVL
          RWKUVKUVLWLWMWOUWDUWCUEIUVLUWCUEZUEUWEUUQIUVLUWCWPUWCUWDWQUUOUWFIUUOU
          WCUVLUEUWFSJWRUWCUVLWQWSWTXAWSAUWBUVTSSUFUGZUURUHUGZUEZUUSAUWAUWHUVTA
          UWAUVKUWHAUVLUVKXBUWAUVKUDAJUVKPXCUVLUVKXDVTVJUWGUURUHXOXEXFXGAUURXHT
          ZSUUSTZUUSUWIUDAKXHTZUWJOKXIVNZAUURSXJUJZTUWKAUURXHUWNUWMXPXKSUURXLVN
          XHSSUURXMXNXQXRZAUURUWGUKUGZUUTUVAAUWPUURVJUKUGZUUTVJUWGUURUKXOXSAUWQ
          UUTUDZUUTVJUFUGZUURUDZAUUQUIUJZUUSUIUJZUWSUURAUUQUUSUIUWOXTAUXAUUTUUO
          UIUJZUFUGZUWSIYFTZUUOYFTUUPUXAUXDUDIUVMYFRUVKYFTUVMYFTVJUURYAUVKUVLYB
          WJYCZSJYDUVSIUUOYEYGAUXCVJUUTUFASJUNUXCVJUDAJSAJUVKTJSUNZPUVHUXGBJUVK
          UVBJSYHUVRYIVNYJSJSYKVFYLQYMVTYNYOAUWJUURYRTUXBUURUDUWMUURYPUURUUAUUB
          UUCAUURYQTZVJYQTZUUTYQTZUWRUWTUUIAUWJUXHUWMUURYSVNUXIAVJVGUUDWGUXJAUU
          TUXEUUTYRTUXEUXFUUEIUUFWJUUGWGUURVJUUTUUHYTUUJXRAKYQTZSYQTZUXLUWPUVAU
          DAUWLUXKOKYSVNUXLAUUKWGZUXMKSSUULYTUUMUUN $.
          $( [23-Jan-2015] $)

        ${
          subfacp1lem2.5 $e |- F =
            ( G u. { <. 1 , M >. , <. M , 1 >. } ) $.
          subfacp1lem2.6 $e |- ( ph -> G : K -1-1-onto-> K ) $.
          $( Lemma for ~ subfacp1 .  Properties of a bijection on ` K `
             augmented with the two-element flip to get a bijection on
             ` K u. { 1 , M } ` . $)
          subfacp1lem2a $p |- ( ph ->
            ( F : ( 1 ... ( N + 1 ) ) -1-1-onto-> ( 1 ... ( N + 1 ) ) /\
              ( F ` 1 ) = M /\ ( F ` M ) = 1 ) ) $=
            ( c1 caddc co cfz wf1o cfv wceq cpr cun cop cin c0 cz cvv f1oprswap
            wcel mp2an a1i chash cmin subfacp1lem1 simp1d f1oun syl22anc simp2d
            1z wb f1oeq1 ax-mp f1oeq2 syl5bbr f1oeq3 bitrd syl mpbid csn f1ofun
            wfun wss cdm snsspr1 ssun2 sseqtr4i sstri elexi snid f1osn eleqtrri
            f1odm funssfv mp3an23 idi fvsn syl6eq snsspr2 3jca ) AUCMUCUDUEUFUE
            ZWSIUGZUCIUHZLUILIUHZUCUIAKUCLUJZUKZXDJUCLULZLUCULZUJZUKZUGZWTAKKJU
            GXCXCXGUGZKXCUMUNUIZXKXIUBXJAUCUOURLUPURZXJVHSUCLUOUPUQUSUTAXKXDWSU
            IZKVAUHMUCVBUEUIZABCDEFGHKLMNOPQRSTVCZVDZXPKKXCXCJXGVEVFAXMXIWTVIAX
            KXMXNXOVGXMXIWSXDIUGZWTXIXDXDIUGZXMXQIXHUIXRXIVIUAXDXDIXHVJVKXDWSXD
            IVLVMXDWSWSIVNVOVPVQZAXAUCXEVRZUHZLAIVTZXAYAUIZAWTYBXSWSWSIVSVPZYBX
            TIWAUCXTWBZURYCXTXGIXEXFWCXGXHIXGJWDUAWEZWFUCUCVRZYEUCUCUOVHWGZWHYG
            LVRZXTUGYEYGUIUCLYHSWIYGYIXTWKVKWJUCIXTWLWMVPUCLUCUPURYHWNXLSWNWOWP
            AXBLXFVRZUHZUCAYBXBYKUIZYDYBYJIWALYJWBZURYLYJXGIXEXFWQYFWFLYIYMLSWH
            YIYGYJUGYMYIUILUCSYHWIYIYGYJWKVKWJLIYJWLWMVPLUCSYHWOWPWR $.
            $( [23-Jan-2015] $)

          $( Lemma for ~ subfacp1 .  Properties of a bijection on ` K `
             augmented with the two-element flip to get a bijection on
             ` K u. { 1 , M } ` . $)
          subfacp1lem2b $p |- ( ( ph /\ X e. K ) -> ( F ` X ) = ( G ` X ) ) $=
            ( wcel wa wfun wss cdm cfv wceq caddc cfz wf1o subfacp1lem2a simp1d
            c1 co f1ofun syl adantr cop cpr cun ssun1 sseqtr4i a1i f1odm eleq2d
            biimpar funssfv syl3anc ) ANKUDZUEZIUFZJIUGZNJUHZUDZNIUINJUIUJAVNVL
            AUPMUPUKUQULUQZVRIUMZVNAVSUPIUILUJLIUIUPUJABCDEFGHIJKLMOPQRSTUAUBUC
            UNUOVRVRIURUSUTVOVMJJUPLVALUPVAVBZVCIJVTVDUBVEVFAVQVLAVPKNAKKJUMVPK
            UJUCKKJVGUSVHVINIJVJVK $.
            $( [23-Jan-2015] $)
        $}

        ${
          subfacp1lem3.b $e |- B = { g e. A |
            ( ( g ` 1 ) = M /\ ( g ` M ) = 1 ) } $.
          subfacp1lem3.c $e |- C = { f | ( f : K -1-1-onto-> K /\
            A. y e. K ( f ` y ) =/= y ) } $.
          $( Lemma for ~ subfacp1 .  In ~ subfacp1lem6 we cut up the set of all
             derangements on ` 1 ... ( N + 1 ) ` first according to the value
             at ` 1 ` , and then by whether or not
             ` ( f `` ( f `` 1 ) ) = 1 ` .  In this lemma, we show that the
             subset of all ` N + 1 ` derangements that satisfy this for fixed
             ` M = ( f `` 1 ) ` is in bijection with ` N - 1 ` derangements, by
             simply dropping the ` x = 1 ` and ` x = M ` points from the
             function to get a derangement on
             ` K = ( 1 ... ( N - 1 ) ) \ { 1 , M } ` . $)
          subfacp1lem3 $p |- ( ph -> ( # ` B ) = ( S ` ( N - 1 ) ) ) $=
            ( vb vc chash cfv c1 cmin co cen wbr wceq cres cop cpr cun cvv wcel
            cv cfn wss caddc cfz wf1o wne wral cab fzfi deranglem ax-mp eqeltri
            wa crab mp2an elexi cdif wfo simpr fveq1 eqeq1d elrab2 sylib simpld
            anbi12d vex f1oeq1 neeq1d ralbidv elab2 wf simprbi wb wfn f1ofn syl
            wrex c0 simp2d syl5sseq adantr fnssres syl2anc wsbc simprd syl6eqel
            cin fveq2 eleq1d sbcie ralpr sylanbrc fvres ralbiia rcla4ev sylancr
            sylibr eqeq2 rexbidv eqcom syl5eq simp1d mpbid ralbidva ex cn c2 id
            eqnetrd neeq12d simp3d ralunb raleqdv adantrr adantrl eqtr4d eqeq2d
            eqeq12d syl6bbr eqfnfv2 ssrab2 eqsstri ssfi a1i ccnv wfun wf1 f1of1
            df-f1 fnresdm mpbird f1ofo ssun2 subfacp1lem1 prid2 1re prid1 ffnfv
            cr syl5bb rexbiia ralbii dffo3 resdif syl3anc uncom incom uneqdifeq
            3syl reseq2 f1oeq2 f1oeq3 3bitrd ssralv sylc sylan9eq subfacp1lem2a
            ssun1 resex eqid subfacp1lem2b r19.21bi ralrimiva cuz elfzuz necomd
            eluz2b3 prex unex jca biantrud 3bitr3rd syl6bb 3bitr4d diffi hashen
            en3d csn fveq2i derangval derangen2 3eqtr2ri fveq2d syl5eqr eqtrd )
            AEUFUGZFUFUGZNUHUIUJZHUGZAEFUKULZUXFUXGUMZAUDUEEFUDUTZLUNZUEUTZUHMU
            OZMUHUOZUPZUQZEURUSAEVADVAUSEDVBEVAUSZDUHNUHVCUJZVDUJZUYAIUTZVEZCUT
            ZUYBUGZUYDVFZCUYAVGZVMZIVHZVAQUYAVAUSUYIVAUSUHUXTVIUYGUYAIVJVKVLEUH
            JUTZUGZMUMZMUYJUGZUHUMZVMZJDVNDUBUYOJDUUAUUBDEUUCVOZVPUUDAUXLEUSZUX
            MFUSZAUYQVMZLLUXMVEZUYDUXLUGZUYDVFZCLVGZUYRUYSUYAUHMUPZVQZVUEUXLVUE
            UNZVEZUYTUYSUXLUUEUUFZUYAUYAUXLUYAUNZVRZVUDVUDUXLVUDUNZVRZVUGUYSUYA
            UYAUXLVEZUYAUYAUXLUUGZVUHUYSVUMVUBCUYAVGZUYSUXLDUSZVUMVUOVMZUYSVUPU
            HUXLUGZMUMZMUXLUGZUHUMZVMZUYSUYQVUPVVBVMAUYQVSUYOVVBJUXLDEUYJUXLUMZ
            UYLVUSUYNVVAVVCUYKVURMUHUYJUXLVTWAVVCUYMVUTUHMUYJUXLVTWAWEUBWBWCZWD
            UYHVUQIUXLDUDWFZUYBUXLUMZUYCVUMUYGVUOUYAUYAUYBUXLWGVVFUYFVUBCUYAVVF
            UYEVUAUYDUYDUYBUXLVTWHWIWEQWJWCZWDZUYAUYAUXLUUHVUNUYAUYAUXLWKVUHUYA
            UYAUXLUUIWLUVIUYSUYAUYAVUIVEZVUJUYSVVIVUMVVHUYSVUIUXLUMZVVIVUMWMUYS
            UXLUYAWNZVVJUYSVUMVVKVVHUYAUYAUXLWOWPZUYAUXLUUJWPUYAUYAVUIUXLWGWPUU
            KUYAUYAVUIUULWPUYSVUDVUDVUKWKZBUTZUYDVUKUGZUMZCVUDWQZBVUDVGZVULUYSV
            UKVUDWNZVVNVUKUGZVUDUSZBVUDVGZVVMUYSVVKVUDUYAVBZVVSVVLAVWCUYQALVUDU
            QZVUDUYAVUDLUUMALVUDXGZWRUMZVWDUYAUMZLUFUGZUXHUMZABCDGHIKLMNOPQRSTU
            AUUNZWSZWTZXAUYAVUDUXLXBXCUYSVVNUXLUGZVUDUSZBVUDVGZVWBUYSVWNBUHXDZV
            WNBMXDZVWOUYSVURVUDUSZVWPUYSVURMVUDUYSVUSVVAUYSVUPVVBVVDXEZWDZUHMTU
            UOZXFVWNVWRBUHUHUUSUUPVPZVVNUHUMZVWMVURVUDVVNUHUXLXHXIXJXQUYSVUTVUD
            USZVWQUYSVUTUHVUDUYSVUSVVAVWSXEZUHMVXBUUQZXFVWNVXDBMTVVNMUMZVWMVUTV
            UDVVNMUXLXHXIXJXQVWNBUHMVXBTXKXLVWAVWNBVUDVVNVUDUSVVTVWMVUDVVNVUDUX
            LXMXIXNXQBVUDVUDVUKUURXLUYSVUAVVNUMZCVUDWQZBVUDVGZVVRUYSVXIBUHXDZVX
            IBMXDZVXJUYSVUAUHUMZCVUDWQZVXKUYSMVUDUSVVAVXNVXAVXEVXMVVACMVUDUYDMU
            MZVUAVUTUHUYDMUXLXHZWAXOXPVXIVXNBUHVXBVXCVXHVXMCVUDVVNUHVUAXRXSXJXQ
            UYSVUAMUMZCVUDWQZVXLUYSUHVUDUSVUSVXRVXFVWTVXQVUSCUHVUDUYDUHUMZVUAVU
            RMUYDUHUXLXHZWAXOXPVXIVXRBMTVXGVXHVXQCVUDVVNMVUAXRXSXJXQVXIBUHMVXBT
            XKXLVVQVXIBVUDVVPVXHCVUDVVPVVOVVNUMUYDVUDUSZVXHVVNVVOXTVYAVVOVUAVVN
            UYDVUDUXLXMWAUUTUVAUVBXQCBVUDVUDVUKUVCXLUYAVUDUYAVUDUXLUVDUVEUYSVUE
            LUMZVUGUYTWMAVYBUYQAVUDLUQZUYAUMZVYBAVYCVWDUYAVUDLUVFVWKYAAVWCVUDLX
            GZWRUMVYDVYBWMVWLAVYEVWEWRVUDLUVGAVWFVWGVWIVWJYBYAVUDLUYAUVHXCYCXAV
            YBVUGVUEVUEUXMVEZLVUEUXMVEUYTVYBVUFUXMUMVUGVYFWMVUELUXLUVJVUEVUEVUF
            UXMWGWPVUELVUEUXMUVKVUELLUXMUVLUVMWPYCUYSLUYAVBZVUOVUCAVYGUYQAVWDLU
            YALVUDUVRVWKWTZXAUYSVUMVUOVVGXEVUBCLUYAUVNUVOLLUYBVEZUYFCLVGZVMZUYT
            VUCVMIUXMFUXLLVVEUVSUYBUXMUMZVYIUYTVYJVUCLLUYBUXMWGVYLUYFVUBCLVYLUY
            DLUSZVMUYEVUAUYDVYLVYMUYEUYDUXMUGZVUAUYDUYBUXMVTUYDLUXLXMZUVPWHYDWE
            UCWJXLYEAUXNFUSZUXREUSZAVYPVMZUXRDUSZUHUXRUGZMUMZMUXRUGZUHUMZVMZVYQ
            VYRUYAUYAUXRVEZUYDUXRUGZUYDVFZCUYAVGZVYSVYRWUEWUAWUCVYRBCDGHIKUXRUX
            NLMNOPQANYFUSVYPRXAZAMYGUXTVDUJZUSZVYPSXAZTUAUXRUVTZVYRLLUXNVEZUYDU
            XNUGZUYDVFZCLVGZVYRVYPWUNWUQVMZAVYPVSVYKWURIUXNFUEWFZUYBUXNUMZVYIWU
            NVYJWUQLLUYBUXNWGWUTUYFWUPCLWUTUYEWUOUYDUYDUYBUXNVTWHWIWEUCWJWCZWDZ
            UVQZYBZVYRWUGCVWDVGZWUHVYRWUGCLVGWUGCVUDVGZWVEVYRWUGCLVYRVYMVMZWUFW
            UOUYDVYRBCDGHIKUXRUXNLMNUYDOPQWUIWULTUAWUMWVBUWAZVYRWUPCLVYRWUNWUQW
            VAXEUWBYIUWCVYRWUGCUHXDZWUGCMXDZWVFVYRVYTUHVFZWVIVYRVYTMUHVYRWUEWUA
            WUCWVCWSZAMUHVFZVYPAMYGUWDUGUSZWVMAWUKWVNSMYGUXTUWEWPWVNMYFUSWVMMUW
            GWLWPXAZYIWUGWVKCUHVXBVXSWUFVYTUYDUHUYDUHUXRXHZVXSYHYJXJXQVYRWUBMVF
            ZWVJVYRWUBUHMVYRWUEWUAWUCWVCYKZVYRMUHWVOUWFYIWUGWVQCMTVXOWUFWUBUYDM
            UYDMUXRXHZVXOYHYJXJXQWUGCUHMVXBTXKXLWUGCLVUDYLXLVYRWUGCVWDUYAAVWGVY
            PVWKXAYMYCUYHWUEWUHVMIUXRDUXNUXQWUSUXOUXPUWHUWIUYBUXRUMZUYCWUEUYGWU
            HUYAUYAUYBUXRWGWVTUYFWUGCUYAWVTUYEWUFUYDUYDUYBUXRVTWHWIWEQWJXLVYRWU
            AWUCWVLWVRUWJUYOWUDJUXRDEUYJUXRUMZUYLWUAUYNWUCWWAUYKVYTMUHUYJUXRVTW
            AWWAUYMWUBUHMUYJUXRVTWAWEUBWBXLYEAUYQVYPVMZUXLUXRUMZUXNUXMUMZWMAWWB
            VMZVUAWUFUMZCUYAVGZWUOVYNUMZCLVGZWWCWWDWWEWWGVUAWUOUMZCLVGZWWIWWEWW
            FCLVGZWWFCVWDVGZWWKWWGWWEWWLWWLWWFCVUDVGZVMWWMWWEWWNWWLWWEWWFCUHXDZ
            WWFCMXDZWWNWWEVURVYTUMZWWOWWEVURMVYTAUYQVUSVYPVWTYNAVYPWUAUYQWVLYOY
            PWWFWWQCUHVXBVXSVUAVURWUFVYTVXTWVPYRXJXQWWEVUTWUBUMZWWPWWEVUTUHWUBA
            UYQVVAVYPVXEYNAVYPWUCUYQWVRYOYPWWFWWRCMTVXOVUAVUTWUFWUBVXPWVSYRXJXQ
            WWFCUHMVXBTXKXLUWKWWFCLVUDYLYSAVYPWWLWWKWMUYQVYRWWFWWJCLWVGWUFWUOVU
            AWVHYQYDYOWWEWWFCVWDUYAAVWGWWBVWKXAYMUWLWWHWWJCLVYMWWHWUOVUAUMWWJVY
            MVYNVUAWUOVYOYQWUOVUAXTUWMXNYSWWEVVKUXRUYAWNZWWCWWGWMAUYQVVKVYPVVLY
            NZWWEWUEWWSAVYPWUEUYQWVDYOUYAUYAUXRWOWPCUYAUXLUXRYTXCWWEUXNLWNZUXML
            WNZWWDWWIWMWWEWUNWXAAVYPWUNUYQWVBYOLLUXNWOWPWWEVVKVYGWXBWWTAVYGWWBV
            YHXAUYALUXLXBXCCLUXNUXMYTXCUWNYEUWQUXSFVAUSUXKUXJWMUYPFVYKIVHZVAUCL
            VAUSZWXCVAUSLWUJMUWRZVQZVAUAWUJVAUSWXFVAUSYGUXTVIWUJWXEUWOVKVLZVYJL
            IVJVKVLEFUWPVOXQAUXGVWHHUGZUXIUXGWXCUFUGZLGUGZWXHFWXCUFUCUWSWXDWXJW
            XIUMWXGBCLGIOUWTVKWXDWXJWXHUMWXGBCLGHIKOPUXAVKUXBAVWHUXHHAVWFVWGVWI
            VWJYKUXCUXDUXE $.
            $( [23-Jan-2015] $)
        $}

        ${
          subfacp1lem5.b $e |- B = { g e. A |
            ( ( g ` 1 ) = M /\ ( g ` M ) =/= 1 ) } $.
          subfacp1lem5.f $e |- F =
            ( ( _I |` K ) u. { <. 1 , M >. , <. M , 1 >. } ) $.
          $( Lemma for ~ subfacp1 .  The function ` F ` , which swaps ` 1 `
             with ` M ` and leaves all other elements alone, is a bijection of
             order ` 2 ` , i.e. it is its own inverse. $)
          subfacp1lem4 $p |- ( ph -> `' F = F ) $=
            ( c1 caddc co cfz ccnv wf1o wfn cfv wceq cid cres a1i subfacp1lem2a
            f1oi simp1d f1ocnv f1ofn 3syl syl cv wcel wa cpr wo cun cin c0 cmin
            chash subfacp1lem1 simp2d eleq2d biimpar sylib subfacp1lem2b fvresi
            elun adantl eqtrd fveq2d vex elpr simp3d id eqeq12d syl5ibrcom jaod
            fveq2 imp sylan2b jaodan syldan wi adantr wf ffvelrn sylan f1ocnvfv
            f1of syl2anc mpd eqfnfvd ) ABUDNUDUEUFUGUFZKUHZKAXFXFKUIZXFXFXGUIXG
            XFUJAXHUDKUKZMULZMKUKZUDULZABCDFGHJKUMLUNZLMNOPQRSTUAUCLLXMUIALUQUO
            ZUPZURZXFXFKUSXFXFXGUTVAAXHKXFUJXPXFXFKUTVBABVCZXFVDZVEZXQKUKZKUKZX
            QULZXQXGUKXTULZAXRXQLVDZXQUDMVFZVDZVGZYBXSXQLYEVHZVDZYGAYIXRAYHXFXQ
            ALYEVIVJULYHXFULLVLUKNUDVKUFULABCDFGHJLMNOPQRSTUAVMVNVOVPXQLYEVTVQA
            YDYBYFAYDVEZYAXTXQYJXTXQKYJXTXQXMUKZXQABCDFGHJKXMLMNXQOPQRSTUAUCXNV
            RYDYKXQULALXQVSWAWBZWCYLWBYFAXQUDULZXQMULZVGZYBXQUDMBWDWEAYOYBAYMYB
            YNAYBYMXIKUKZUDULAYPXKUDAXIMKAXHXJXLXOVNZWCAXHXJXLXOWFZWBYMYAYPXQUD
            YMXTXIKXQUDKWKWCYMWGWHWIAYBYNXKKUKZMULAYSXIMAXKUDKYRWCYQWBYNYAYSXQM
            YNXTXKKXQMKWKWCYNWGWHWIWJWLWMWNWOXSXHXTXFVDZYBYCWPAXHXRXPWQAXFXFKWR
            ZXRYTAXHUUAXPXFXFKXBVBXFXFXQKWSWTXFXFXTXQKXAXCXDXE $.
            $( [19-Jan-2015] $)

          subfacp1lem5.c $e |- C = { f | ( f : ( 2 ... ( N + 1 ) ) -1-1-onto->
      ( 2 ... ( N + 1 ) ) /\ A. y e. ( 2 ... ( N + 1 ) ) ( f ` y ) =/= y ) } $.
          $( Lemma for ~ subfacp1 .  In ~ subfacp1lem6 we cut up the set of all
             derangements on ` 1 ... ( N + 1 ) ` first according to the value
             at ` 1 ` , and then by whether or not
             ` ( f `` ( f `` 1 ) ) = 1 ` .  In this lemma, we show that the
             subset of all ` N + 1 ` derangements with
             ` ( f `` ( f `` 1 ) ) =/= 1 ` for fixed ` M = ( f `` 1 ) ` is in
             bijection with derangements of ` 2 ... ( N + 1 ) ` , because
             pre-composing with the function ` F ` swaps ` 1 ` and ` M ` and
             turns the function into a bijection with ` ( f `` 1 ) = 1 ` and
             ` ( f `` x ) =/= x ` for all other ` x ` , so dropping the point
             at ` 1 ` yields a derangement on the ` N ` remaining points. $)
          subfacp1lem5 $p |- ( ph -> ( # ` B ) = ( S ` N ) ) $=
            ( vb vc chash cfv wbr wceq cv ccom c2 c1 caddc cfz cres cop csn cun
            co cvv wcel cfn wss wf1o wne wral wa cab fzfi deranglem ax-mp mp2an
            eqeltri elexi a1i cdif ccnv wfun wfo cid adantr simpr eqeq1d neeq1d
            fveq1 anbi12d elrab2 sylib simpld vex f1oeq1 ralbidv elab2 f1oco wf
            syl2anc 3syl wi idi wb wfn f1ofn syl cc ax-1cn cn f1of fvco3 simprd
            fveq2d eqtrd syl3anc cz syl5eqr c0 sylancl sseldi ad2antrr neeqtrrd
            cuz fveq2 neeq12d syl5ibrcom adantrr necomd eqnetrd ffvelrn necon3d
            f1ocnvfv mpd sylanbrc ex funssfv coeq1d adantrl sylibr cmin eqsstri
            cen crab ssrab2 ssfi wf1 subfacp1lem2a simp1d f1of1 simprbi fnresdm
            f1oi df-f1 mpbird f1ofo f1osn peano2nn nnuz syl6eleq eluzfz1 simp3d
            fnressn 3eqtrd opeq2d sneqd mpbiri resdif fzsn 1p1e2 oveq1i uneq12i
            1z fzsplit eqcomd cin snssd incom wn cle clt 1re 2re ltnlei elfzle1
            1lt2 disjsn mpbir eqtri uneqdifeq mpbid reseq2 f1oeq2 f1oeq3 3bitrd
            mpbi ovex fzp1ss eqsstr3i subfacp1lem4 fveq1d sseli r19.21bi sylan2
            mto eleq2i eldifsn bitri subfacp1lem2b fvresi sylan2br adantlr expr
            adantl pm2.61dne syl2an ralrimiva difexg prex unex coex resex fvres
            cpr fex sylan9eq ralbidva f1oun mpanr12 sylancr bitrd biimpa syldan
            sylan wo eleqtrrd elun nelne2 simp2d f1ofun cdm ssun1 snid eleqtrri
            dmsnop mp3an23 fvsn syl6eq 3netr4d elsni ssun2 f1odm eleq2d biimpar
            imp jaodan snex rcla4v sylc jca coeq2 coass f1ococnv1 eqtr3d eqeq2d
            id fcoi2 syl5ib impbid eqtr4d eqeq12d sbcie ralsn biantrurd syl6bbr
            wsbc ralunb adantlrl raleqdv 3bitr3rd eqfnfv2 fnssres 3bitr4d eqcom
            syl6bb en3d hashen derangen2 derangval fveq2i syl6eqr eluzp1p1 df-2
            syl6eleqr w3a eluz2 hashfz sylbi nncn subsub subaddrii oveq2i pncan
            2cn syl5eq 3eqtr2d ) AEUHUIZFUHUIZOHUIZAEFUUBUJZVXFVXGUKZAUFUGEFLUF
            ULZUMZUNOUOUPVBZUQVBZURZLUOUOUSZUTZUGULZVAZUMZEVCVDAEVEDVEVDEDVFEVE
            VDZDUOVXMUQVBZVYBIULZVGZCULZVYCUIZVYEVHZCVYBVIZVJZIVKZVERVYBVEVDVYJ
            VEVDUOVXMVLVYHVYBIVMVNVPEUOJULZUIZNUKZNVYKUIZUOVHZVJZJDUUCDUCVYPJDU
            UDUUADEUUEVOZVQVRAVXKEVDZVXOFVDZAVYRVJZVXNVXNVXOVGZVYEVXLUIZVYEVHZC
            VXNVIZVYSVYTVYBUOUTZVSZWUFVXLWUFURZVGZWUAVYTVXLVTWAZVYBVYBVXLVYBURZ
            WBZWUEWUEVXLWUEURZWBZWUHVYTVYBVYBVXLVGZVYBVYBVXLUUFZWUIVYTVYBVYBLVG
            ZVYBVYBVXKVGZWUNAWUPVYRAWUPUOLUIZNUKZNLUIZUOUKZABCDGHIKLWCMURZMNOPQ
            RSTUAUBUDMMWVBVGZAMUULZVRZUUGZUUHZWDZVYTWUQVYEVXKUIZVYEVHZCVYBVIZVY
            TVXKDVDZWUQWVKVJZVYTWVLUOVXKUIZNUKZNVXKUIZUOVHZVJZVYTVYRWVLWVRVJAVY
            RWEVYPWVRJVXKDEVYKVXKUKZVYMWVOVYOWVQWVSVYLWVNNUOVYKVXKWHWFWVSVYNWVP
            UONVYKVXKWHWGWIUCWJWKZWLVYIWVMIVXKDUFWMZVYCVXKUKZVYDWUQVYHWVKVYBVYB
            VYCVXKWNWWBVYGWVJCVYBWWBVYFWVIVYEVYEVYCVXKWHWGWOWIRWPWKZWLZVYBVYBVY
            BLVXKWQWSZVYBVYBVXLUUIWUOVYBVYBVXLWRWUIVYBVYBVXLUUMUUJWTVYTVYBVYBWU
            JVGZWUKVYTWWFWUNVYTWUNXAWWEXBVYTWUJVXLUKZWWFWUNXCVYTWUNVXLVYBXDZWWG
            WWEVYBVYBVXLXEZVYBVXLUUKWTVYBVYBWUJVXLWNXFUUNVYBVYBWUJUUOXFVYTWUEWU
            EWULVGZWUMVYTWWJWUEWUEVXQVGZUOUOUOXGXHVQZWWLUUPZVYTWULVXQUKWWJWWKXC
            VYTWULUOUOVXLUIZUSZUTZVXQVYTWWHUOVYBVDZWULWWPUKVYTWUNWWHWWEWWIXFZVY
            TWWQXAAWWQVYRAVXMUOYCUIZVDWWQAVXMXIWWSAOXIVDZVXMXIVDZSOUUQXFZUURUUS
            UOVXMUUTXFZWDZXBVYBUOVXLUVBWSVYTWWOVXPVYTWWNUOUOVYTWWNWVNLUIZWUTUOV
            YTVYBVYBVXKWRZWWQWWNWXEUKVYTWUQWXFWWDVYBVYBVXKXJXFZWXDVYBVYBUOLVXKX
            KWSVYTWVNNLVYTWVOWVQVYTWVLWVRWVTXLZWLXMAWVAVYRAWUPWUSWVAWVFUVAZWDZU
            VCZUVDUVEXNWUEWUEWULVXQWNXFUVFWUEWUEWULUUOXFVYBWUEVYBWUEVXLUVGXOVYT
            WUFVXNUKZWUHWUAXCAWXLVYRAWUEVXNVAZVYBUKZWXLAWXMUOUOUQVBZUOUOUPVBZVX
            MUQVBZVAZVYBWXOWUEWXQVXNUOXPVDZWXOWUEUKUVLUOUVHVNWXPUNVXMUQUVIUVJZU
            VKAVYBWXRAWXAWWQVYBWXRUKWXBAWWQXAWXCXBXIUOUOVXMUVMWSUVNXQZAWUEVYBVF
            WUEVXNUVOZXRUKZWXNWXLXCAUOVYBWXCUVPWYBVXNWUEUVOZXRWUEVXNUVQWYDXRUKU
            OVXNVDZUVRZWYEUNUOUVSUJZUOUNUVTUJWYGUVRUWEUOUNUWAUWBUWCUWOUOUNVXMUW
            DUXDZVXNUOUWFUWGUWHZWUEVXNVYBUWIXSUWJWDWXLWUHWUFWUFVXOVGZVXNWUFVXOV
            GWUAWXLWUGVXOUKWUHWYJXCWUFVXNVXLUWKWUFWUFWUGVXOWNXFWUFVXNWUFVXOUWLW
            UFVXNVXNVXOUWMUWNXFUWJVYTWUCCVXNVYTVYEVXNVDZVJZWUBWVILUIZVYEWYLWXFV
            YEVYBVDZWUBWYMUKVYTWXFWYKWXGWDWYLVXNVYBVYEVXNWXQVYBWXTWXSVXMVCVDWXQ
            VYBVFWXSUVLXBOUOUPUWPUOVXMVCUWQVOUWRZVYTWYKWEXTVYBVYBVYELVXKXKWSWYL
            VYELVTZUIZWVIVHWYMVYEVHWYLWYQVYELUIZWVIAWYQWYRUKZVYRWYKAVYEWYPLABCD
            EGHIJKLMNOPQRSTUAUBUCUDUWSZUWTZYAWYLWVIWYRWYLWVIWYRVHZVYENWYLXUBVYE
            NUKZWVPWUTVHZVYTXUDWYKVYTWVPUOWUTVYTWVOWVQWXHXLWXJYBWDXUCWVIWVPWYRW
            UTVYENVXKYDVYENLYDZYEYFVYTWYKVYENVHZXUBVYTWYKXUFVJZVJWVIVYEWYRVYTWY
            KWVJXUFWYKVYTWYNWVJVXNVYBVYEWYOUXAVYTWVJCVYBVYTWUQWVKWWCXLUXBUXCYGA
            XUGWYRVYEUKZVYRXUGAVYEMVDZXUHXUIVYEVXNNUTZVSZVDXUGMXUKVYEUBUXEVYEVX
            NNUXFUXGAXUIVJWYRVYEWVBUIZVYEABCDGHIKLWVBMNOVYEPQRSTUAUBUDWVEUXHXUI
            XULVYEUKAMVYEUXIUXMXNUXJZUXKYBUXLUXNYHYIWYLWYMVYEWYQWVIWYLWUPWVIVYB
            VDZWYMVYEUKWYQWVIUKXAVYTWUPWYKWVHWDVYTWXFWYNXUNWYKVYTWXFXAWXGXBVXNV
            YBVYEVXNVYBVFZWYOXBZUXAVYBVYBVYEVXKYJUXOVYBVYBWVIVYELYLWSYKYMYIUXPV
            XNVXNVYCVGZVYGCVXNVIZVJZWUAWUDVJIVXOFVXLVXNLVXKLWVBUONUSZNUOUSZUYCZ
            VAVCUDWVBXVBMMWVBWRZMVCVDWVBVCVDWVCXVCWVDMMWVBXJVNMXUKVCUBVXNVEVDZX
            UKVCVDUNVXMVLZVXNXUJVEUXQVNVPMMVCWVBUYDVOXUTXVAUXRUXSVPZWWAUXTUYAVY
            CVXOUKZXUQWUAXURWUDVXNVXNVYCVXOWNXVGVYGWUCCVXNXVGWYKVJVYFWUBVYEXVGW
            YKVYFVYEVXOUIZWUBVYEVYCVXOWHVYEVXNVXLUYBZUYEWGUYFWIUEWPYNYOAVXRFVDZ
            VXTEVDZAXVJVJZVXTDVDZUOVXTUIZNUKZNVXTUIZUOVHZVJZXVKXVLVYBVYBVXTVGZV
            YEVXTUIZVYEVHZCVYBVIZXVMXVLWUPVYBVYBVXSVGZXVSAWUPXVJWVGWDZAXVJWXMWX
            MVXSVGZXWCXVLWWKVXNVXNVXRVGZXWEWWMXVLXWFVYEVXRUIZVYEVHZCVXNVIZXVLXV
            JXWFXWIVJZAXVJWEXUSXWJIVXRFUGWMZVYCVXRUKZXUQXWFXURXWIVXNVXNVYCVXRWN
            XWLVYGXWHCVXNXWLVYFXWGVYEVYEVYCVXRWHWGWOWIUEWPWKZWLZWWKXWFVJWYCWYCX
            WEWYIWYIWUEWUEVXNVXNVXQVXRUYGUYHUYIZAXWEXWCAWXNXWEXWCXCWYAWXNXWEVYB
            WXMVXSVGXWCWXMVYBWXMVXSUWLWXMVYBVYBVXSUWMUYJXFUYKUYLZVYBVYBVYBLVXSW
            QWSXVLXWACVYBXVLWYNVJZXVTVYEVXSUIZLUIZVYEXVLVYBVYBVXSWRZWYNXVTXWSUK
            XVLXWCXWTXWPVYBVYBVXSXJXFZVYBVYBVYELVXSXKUYMXWQWYQXWRVHXWSVYEVHXWQW
            YQWYRXWRAWYSXVJWYNXUAYAXVLWYNVYEWUEVDZWYKUYNZWYRXWRVHZXWQVYEWXMVDXX
            CXWQVYEVYBWXMXVLWYNWEAWXNXVJWYNWYAYAUYOVYEWUEVXNUYPWKXVLXXBXXDWYKXV
            LXXBXXDXVLXXDXXBWURUOVXSUIZVHXVLNUOWURXXEANUOVHZXVJANVXNVDZWYFXXFTW
            YFAWYHVRNUOVXNUYQWSWDAWUSXVJAWUPWUSWVAWVFUYRZWDZXVLXXEUOVXQUIZUOXVL
            VXSWAZXXEXXJUKZXVLXWEXXKXWOWXMWXMVXSUYSXFZXXKVXQVXSVFUOVXQUYTZVDXXL
            VXQVXRVUAUOWUEXXNUOWWLVUBUOUOVUDVUCUOVXSVXQYPVUEXFUOUOWWLWWLVUFVUGZ
            VUHXXBWYRWURXWRXXEXXBVYEUOLVYEUOVUIZXMXXBVYEUOVXSXXPXMYEYFVUNXVLWYK
            VJZXWRWYRXXQXWRXWGWYRXXQXXKVXRVXSVFZVYEVXRUYTZVDZXWRXWGUKZXVLXXKWYK
            XXMWDXXRXXQVXRVXQVUJZVRXVLXXTWYKXVLXXSVXNVYEXVLXWFXXSVXNUKXVLXWFXAX
            WNXBZVXNVXNVXRVUKXFZVULVUMVYEVXSVXRYPXOZXXQXWGWYRVHZVYENXXQXYFXUCNV
            XRUIZWUTVHXXQXYGUOWUTXVLXYGUOVHZWYKXVLXYGVXNVDZWYFXYHXVLVXNVXNVXRWR
            ZXXGXYIXVLXWFXYJXYCVXNVXNVXRXJXFAXXGXVJTWDZVXNVXNNVXRYJWSZWYHXYGUOV
            XNUYQXSWDAWVAXVJWYKWXIYAYBXUCXWGXYGWYRWUTVYENVXRYDZXUEYEYFXVLWYKXUF
            XYFXVLXUGVJXWGVYEWYRXVLWYKXWHXUFXVLXWHCVXNXVLXWFXWIXWMXLZUXBYGAXUGX
            UHXVJXUMUXKYBUXLUXNYIYHVUOUYLYIXWQXWSVYEWYQXWRXWQWUPXWRVYBVDZXWSVYE
            UKWYQXWRUKXAXVLWUPWYNXWDWDXVLXWTWYNXYOXXAVYBVYBVYEVXSYJUYMVYBVYBXWR
            VYELYLWSYKYMYIUXPVYIXVSXWBVJIVXTDLVXSXVFVXQVXRVXPVUPXWKUXSUXTVYCVXT
            UKZVYDXVSVYHXWBVYBVYBVYCVXTWNXYPVYGXWACVYBXYPVYFXVTVYEVYEVYCVXTWHWG
            WOWIRWPYNXVLXVOXVQXVLXVNXXELUIZWURNXVLXWTWWQXVNXYQUKXXAAWWQXVJWXCWD
            VYBVYBUOLVXSXKWSXVLXXEUOLXVLXXEUOUKZXAXXOXBXMXVLWUSXAXXIXBUVCXVLXVP
            XYGLUIZUOXVLXVPNVXSUIZLUIZXYSXVLXWTNVYBVDZXVPYUAUKXXAAYUBXVJAVXNVYB
            NWYOTXTWDVYBVYBNLVXSXKWSXVLXYTXYGLXVLXXKXXRNXXSVDXYTXYGUKXXMXXRXVLX
            YBVRXVLNVXNXXSXYKXYDUYONVXSVXRYPXOXMXNXVLUOWYPUIZXYGVHXYSUOVHXVLYUC
            NXYGAYUCNUKXVJAYUCWURNAUOWYPLWYTUWTAWUSXAXXHXBXNWDXVLXYGNXVLXXGXWIX
            YGNVHZXVLXXGXAXYKXBXYNXWHYUDCNVXNXUCXWGXYGVYENXYMXUCVVEYEVUQVURYHYI
            XVLXYSUOYUCXYGXVLWUPXYGVYBVDXYSUOUKYUCXYGUKXAXWDXVLVXNVYBXYGWYOXYLX
            TVYBVYBXYGUOLYLWSYKYMYIVUSVYPXVRJVXTDEVYKVXTUKZVYMXVOVYOXVQYUEVYLXV
            NNUOVYKVXTWHWFYUEVYNXVPUONVYKVXTWHWGWIUCWJYNYOAVYRXVJVJZVXKVXTUKZVX
            RVXOUKZXCAYUFVJZYUGVXLVXSUKZYUHYUIYUGYUJYUGVXLLVXTUMZUKYUIYUJVXKVXT
            LVUTYUIYUKVXSVXLYUIYUKLLUMZVXSUMZVXSLLVXSVVAYUIYUMWCVYBURZVXSUMZVXS
            YUIYULYUNVXSAYULYUNUKYUFAWYPLUMZYULYUNAWYPLLWYTYQAWUPYUPYUNUKWVGVYB
            VYBLVVBXFVVCWDZYQYUIXWTYUOVXSUKAXVJXWTVYRXXAYRVYBVYBVXSVVFXFXNXQVVD
            VVGYUJLVXLUMZVXTUKYUIYUGVXLVXSLVUTYUIYURVXKVXTYUIYURYULVXKUMZVXKLLV
            XKVVAYUIYUSYUNVXKUMZVXKYUIYULYUNVXKYUQYQYUIWXFYUTVXKUKAVYRWXFXVJWXG
            YGVYBVYBVXKVVFXFXNXQWFVVGVVHYUIYUJVXOVXRUKZYUHYUIWUBXWRUKZCVYBVIZXV
            HXWGUKZCVXNVIZYUJYVAYUIYVBCVXNVIZYVBCWXMVIZYVEYVCYUIYVFYVBCWUEVIZYV
            FVJYVGYUIYVHYVFYUIYVBCUOVVOZYVHYUIWWNXXEUKZYVIYUIWWNUOXXEAVYRWWNUOU
            KXVJWXKYGAXVJXYRVYRXXOYRVVIYVBYVJCUOWWLVYEUOUKWUBWWNXWRXXEVYEUOVXLY
            DVYEUOVXSYDVVJVVKYSYVBCUOWWLVVLYSVVMYVBCWUEVXNVVPVVNYUIYVBYVDCVXNYU
            IWYKVJZWUBXVHXWRXWGYVKXVHWUBWYKXVHWUBUKYUIXVIUXMUVNAXVJWYKXYAVYRXYE
            VVQVVJUYFYUIYVBCWXMVYBAWXNYUFWYAWDVVRVVSYUIWWHVXSVYBXDZYUJYVCXCAVYR
            WWHXVJWWRYGZYUIXWCYVLAXVJXWCVYRXWPYRVYBVYBVXSXEXFCVYBVXLVXSVVTWSYUI
            VXOVXNXDZVXRVXNXDZYVAYVEXCYUIYVNXAYUIWWHXUOYVNYVMXUPVYBVXNVXLVWAXSX
            BYUIYVOXAYUIXWFYVOAXVJXWFVYRXWNYRVXNVXNVXRXEXFXBCVXNVXOVXRVVTWSVWBV
            XOVXRVWCVWDUYJYOVWEVYAFVEVDVXJVXIXCVYQFXUSIVKZVEUEXVDYVPVEVDXVEXURV
            XNIVMVNVPEFVWFVOYSAVXGVXNUHUIZHUIZVXHXVDYVRVXGUKXVEXVDVXNGUIZYVRVXG
            BCVXNGHIKPQVWGXVDYVSYVPUHUIVXGBCVXNGIPVWHFYVPUHUEVWIVWJVVCVNAYVQOHA
            YVQVXMUNYTVBUOUPVBZVXMUNUOYTVBZYTVBZOAVXMUNYCUIZVDZYVQYVTUKZAVXMWXP
            YCUIZYWCAOWWSVDVXMYWFVDAOXIWWSSUURUUSUOOVWKXFUNWXPYCVWLVWIVWMYWDUNX
            PVDVXMXPVDUNVXMUVSUJVWNYWEUNVXMVWOUNVXMVWPVWQXFAVXMXGVDZUNXGVDZUOXG
            VDZYWBYVTUKAWXAYWGWXBVXMVWRXFYWHAVXCVRYWIAXHVRVXMUNUOVWSXOAYWBVXMUO
            YTVBZOYWAUOVXMYTUNUOUOVXCXHXHUVIVWTVXAAOXGVDZYWIYWJOUKAWWTYWKSOVWRX
            FYWIXHXBOUOVXBXSVXDVXEXMXQXN $.
            $( [23-Jan-2015] $)
        $}
      $}

      $( Lemma for ~ subfacp1 .  By induction, we cut up the set of all
         derangements on ` N + 1 ` according to the ` N ` possible values of
         ` ( f `` 1 ) ` (since ` ( f `` 1 ) =/= 1 ` ), and for each set for
         fixed ` M = ( f `` 1 ) ` , the subset of derangements with
         ` ( f `` M ) = 1 ` has size ` S ( N - 1 ) ` (by ~ subfacp1lem3 ),
         while the subset with ` ( f `` M ) =/= 1 ` has size ` S ( N ) ` (by
         ~ subfacp1lem5 ).  Adding it all up yields the desired equation
         ` N ( S ( N ) + S ( N - 1 ) ) ` for the number of derangements on
         ` N + 1 ` . $)
      subfacp1lem6 $p |- ( N e. NN ->
        ( S ` ( N + 1 ) ) = ( N x. ( ( S ` N ) + ( S ` ( N - 1 ) ) ) ) ) $=
        ( vg wcel c1 caddc co cfv chash wceq wi vm vz vh cfz crab cmin cmul cn0
        cn cv peano2nn nnnn0 syl subfacval wf1o wne wral cab cfn fveq2i syl6eqr
        wa fzfid eqtrd adantr nnuz syl6eleq expcom ss2abdv fveq1 cbvabv 3sstr4g
        wss ssabral sylib sylibr fveq2d cc0 eleq1 csn oveq2 ax-mp syl6eq eleq2d
        elsnc rabbidv oveq1 ax-1cn oveq1d eqeq12d imbi12d imbi2d c0 wn fveq2 id
        neeq12d neeq1d syl5bbr rabeq0 cc ffvelrni eqtr4d ad2antrr simpr syl3anc
        ex cun wo wb unrab cin ssrab2 ssfi mp2an inrab rgenw mpbir eqtri hashun
        cvv mp3an a1i nncn ad2antlr sylancl mpbi c2 cop mpd eqid eqeq1d anbi12d
        cbvrabv f1oeq1 cbvralv ralbidv syl5bb 3eqtrd a2d derangval f1of eluzfz1
        wf cuz ffvelrn syl5 eleq1d rabid2 elfz1end cz fzsn syl6bb subidi rcla4v
        1z fvex adantld df-ne hash0 subfacf nnm1nn0 nn0addcl syl2anc nn0cn 3syl
        mul02 a1d simplr peano2fzr imim1d elfzp1 deranglem eqeltri vex fzp1disj
        fzfi inelcm sylan2br necon2bi mp2b addsub adddir mulid2 exmidne biantru
        subcl orcom andi bitri rabbiia eqtr4i necon3ai adantl cid cdif cres cpr
        imnan simpll nnne0 addid2i eqeq2i 0cn addcan2 mp3an23 necon3bbid mpbird
        elfzp12 biimpa ord df-2 oveq1i syl6eleqr ovex subfacp1lem5 subfacp1lem3
        oveq12d syl5eq oveq2d syl5ibr syld nnind mpcom pncan ) HUIMZHNOPZEQZNLU
        JZQZNUYGUDPZMZLCUEZRQZUYGNUFPZHEQZHNUFPZEQZOPZUGPZHUYSUGPUYFUYHCRQZUYNU
        YFUYHUYKDQZVUAUYFUYGUHMZUYHVUBSUYFUYGUIMZVUCHUKZUYGULUMABDEFGUYGIJUNUMU
        YFVUBUYKUYKFUJZUOZBUJZVUFQZVUHUPZBUYKUQZVBZFURZRQZVUAUYFUYKUSMZVUBVUNSU
        YFNUYGVCABUYKDFIUUAUMCVUMRKUTVAVDUYFCUYMRUYFUYLLCUQZCUYMSUYFCUYLLURZVMV
        UPUYFVUMNVUFQZUYKMZFURCVUQUYFVULVUSFVULUYKUYKVUFUUDZUYFVUSVUGVUTVUKUYKU
        YKVUFUUBVEUYFNUYKMZVUTVUSTUYFUYGNUUEQZMZVVAUYFUYGUIVVBVUEVFVGZNUYGUUCUM
        ZVUTVVAVUSUYKUYKNVUFUUFVHUMUUGVIKUYLVUSLFUYIVUFSZUYJVURUYKNUYIVUFVJZUUH
        VKVLUYLLCVNVOUYLLCUUIVPVQVDUYFUYGUYKMZUYNUYTSZUYFVUDVVHVUEUYGUUJVOVUDUY
        FVVHVVITZVUEUYFAUJZUYKMZUYJNVVKUDPZMZLCUEZRQZVVKNUFPZUYSUGPZSZTZTUYFVVA
        UYJNSZLCUEZRQZVRUYSUGPZSZTZTUYFUAUJZUYKMZUYJNVWGUDPZMZLCUEZRQZVWGNUFPZU
        YSUGPZSZTZTUYFVWGNOPZUYKMZUYJNVWQUDPZMZLCUEZRQZVWQNUFPZUYSUGPZSZTZTUYFV
        VJTAUAUYGVVKNSZVVTVWFUYFVXGVVLVVAVVSVWEVVKNUYKVSVXGVVPVWCVVRVWDVXGVVOVW
        BRVXGVVNVWALCVXGVVNUYJNVTZMVWAVXGVVMVXHUYJVXGVVMNNUDPZVXHVVKNNUDWANUUKM
        VXIVXHSUUPNUULWBWCWDUYJNNUYIUUQZWEUUMWFVQVXGVVQVRUYSUGVXGVVQNNUFPVRVVKN
        NUFWGNWHUUNWCWIWJWKWLVVKVWGSZVVTVWPUYFVXKVVLVWHVVSVWOVVKVWGUYKVSVXKVVPV
        WLVVRVWNVXKVVOVWKRVXKVVNVWJLCVXKVVMVWIUYJVVKVWGNUDWAWDWFVQVXKVVQVWMUYSU
        GVVKVWGNUFWGWIWJWKWLVVKVWQSZVVTVXFUYFVXLVVLVWRVVSVXEVVKVWQUYKVSVXLVVPVX
        BVVRVXDVXLVVOVXARVXLVVNVWTLCVXLVVMVWSUYJVVKVWQNUDWAWDWFVQVXLVVQVXCUYSUG
        VVKVWQNUFWGWIWJWKWLVVKUYGSZVVTVVJUYFVXMVVLVVHVVSVVIVVKUYGUYKVSVXMVVPUYN
        VVRUYTVXMVVOUYMRVXMVVNUYLLCVXMVVMUYKUYJVVKUYGNUDWAWDWFVQVXMVVQUYOUYSUGV
        VKUYGNUFWGWIWJWKWLUYFVWEVVAUYFVWCVRVWDUYFVWCWMRQVRUYFVWBWMRUYFVWAWNZLCU
        QZVWBWMSUYFCVXNLURZVMVXOUYFVUMVURNUPZFURCVXPUYFVULVXQFUYFVUKVXQVUGUYFVV
        AVUKVXQTVVEVUJVXQBNUYKVUHNSZVUIVURVUHNVUHNVUFWOVXRWPWQUUOUMUURVIKVXNVXQ
        LFVXNUYJNUPVVFVXQUYJNUUSVVFUYJVURNVVGWRWSVKVLVXNLCVNVOVWALCWTVPVQUUTWCU
        YFUYSUHMZUYSXAMZVWDVRSUYFUYPUHMZUYRUHMZVXSUYFHUHMVYAHULUHUHHEABDEFGIJUV
        AZXBUMUYFUYQUHMVYBHUVBUHUHUYQEVYCXBUMUYPUYRUVCUVDZUYSUVEZUYSUVGUVFXCUVH
        VWGUIMZUYFVWPVXFUYFVYFVWPVXFTUYFVYFVBZVWPVWRVWOTVXFVYGVWRVWHVWOVYGVWRVW
        HVYGVWRVBZVWGVVBMZVUDVWRVWHVYHVWGUIVVBUYFVYFVWRUVIVFVGZUYFVUDVYFVWRVUEX
        DVYGVWRXEVWGNUYGUIUVJXFXGUVKVYGVWRVWOVXEVYGVWRVWOVXETVWOVXEVYHVWLUYJVWQ
        SZLCUEZRQZOPZVWNVYMOPZSVWLVWNVYMOWGVYHVXBVYNVXDVYOVYHVXBVWKVYLXHZRQZVYN
        VYHVXAVYPRVYHVXAVWJVYKXIZLCUEVYPVYHVWTVYRLCVYHVYIVWTVYRXJVYJUYJNVWGUVLU
        MWFVWJVYKLCXKVAVQVYQVYNSZVYHVWKUSMZVYLUSMZVWKVYLXLZWMSVYSCUSMZVWKCVMVYT
        CVUMUSKVUOVUMUSMNUYGUVQVUKUYKFUVMWBUVNZVWJLCXMCVWKXNXOWUCVYLCVMWUAWUDVY
        KLCXMCVYLXNXOWUBVWJVYKVBZLCUEZWMVWJVYKLCXPWUFWMSWUEWNZLCUQWUGLCVWGYAMVW
        IVWQVTZXLZWMSWUGUAUVONVWGYAUVPWUEWUIWMVYKVWJUYJWUHMWUIWMUPUYJVWQVXJWEUY
        JVWIWUHUVRUVSUVTUWAXQWUELCWTXRXSVWKVYLXTYBYCVDVYHVXDVWMNOPZUYSUGPZVWNNU
        YSUGPZOPZVYOVYHVXCWUJUYSUGVYHVWGXAMZNXAMZWUOVXCWUJSVYFWUNUYFVWRVWGYDZYE
        ZWUOVYHWHYCZWURVWGNNUWBXFWIVYHVWMXAMZWUOVXTWUKWUMSVYHWUNWUOWUSWUQWHVWGN
        UWGYFWURVYHVXSVXTUYFVXSVYFVWRVYDXDVYEUMZVWMNUYSUWCXFVYHWULVYMVWNOVYHWUL
        UYSVYMVYHVXTWULUYSSWUTUYSUWDUMVYHVYMVYKVWQUYIQZNUPZVBZLCUEZRQZVYKWVANSZ
        VBZLCUEZRQZOPZUYSVYMWVDWVHXHZRQZWVJVYLWVKRVYLWVCWVGXIZLCUEWVKVYKWVMLCVY
        KWVMXJUYICMVYKVYKWVBWVFXIZVBWVMWVNVYKWVFWVBXIWVNWVANUWEWVFWVBUWHYGUWFVY
        KWVBWVFUWIUWJYCUWKWVCWVGLCXKUWLUTWVDUSMZWVHUSMZWVDWVHXLZWMSWVLWVJSWUCWV
        DCVMWVOWUDWVCLCXMCWVDXNXOWUCWVHCVMWVPWUDWVGLCXMCWVHXNXOWVQWVCWVGVBZLCUE
        ZWMWVCWVGLCXPWVSWMSWVRWNZLCUQWVTLCWVCWVGWNZTWVTWVBWWAVYKWVGWVANVYKWVFXE
        UWMUWNWVCWVGUWSYGXQWVRLCWTXRXSWVDWVHXTYBXSVYHWVEUYPWVIUYROVYHABCWVDYHUY
        GUDPZWWBUYIUOZUBUJZUYIQZWWDUPZUBWWBUQZVBZLURDEFUCGUWOWWBWUHUWPZUWQNVWQY
        IVWQNYIUWRXHZWWIVWQHIJKUYFVYFVWRUWTZVYHVWQNNOPZUYGUDPZWWBVYHVWQNSZWNZVW
        QWWMMZVYFWWOUYFVWRVYFWWOVWGVRUPVWGUXAVYFWWNVWGVRWWNVWQVRNOPZSZVYFVWGVRS
        ZWWQNVWQNWHUXBUXCVYFWUNWWRWWSXJZWUPWUNVRXAMWUOWWTUXDWHVWGVRNUXEUXFUMWSU
        XGUXHYEVYHWWNWWPVYGVWRWWNWWPXIZVYGVVCVWRWXAXJUYFVVCVYFVVDVEVWQNUYGUXIUM
        UXJUXKYJYHWWLUYGUDUXLUXMUXNZVWGNOUXOZWWIYKZWVCNUCUJZQZVWQSZVWQWXEQZNUPZ
        VBLUCCUYIWXESZVYKWXGWVBWXIWXJUYJWXFVWQNUYIWXEVJYLZWXJWVAWXHNVWQUYIWXEVJ
        ZWRYMYNWWJYKWWHWWBWWBVUFUOZVUJBWWBUQZVBLFVVFWWCWXMWWGWXNWWBWWBUYIVUFYOW
        WGVUHUYIQZVUHUPZBWWBUQVVFWXNWWFWXPUBBWWBWWDVUHSZWWEWXOWWDVUHWWDVUHUYIWO
        WXQWPWQZYPVVFWXPVUJBWWBVVFWXOVUIVUHVUHUYIVUFVJWRZYQYRYMVKUXPVYHABCWVHWW
        IWWIUYIUOZWWFUBWWIUQZVBZLURDEFUCGWWIVWQHIJKWWKWXBWXCWXDWVGWXGWXHNSZVBLU
        CCWXJVYKWXGWVFWYCWXKWXJWVAWXHNWXLYLYMYNWYBWWIWWIVUFUOZVUJBWWIUQZVBLFVVF
        WXTWYDWYAWYEWWIWWIUYIVUFYOWYAWXPBWWIUQVVFWYEWWFWXPUBBWWIWXRYPVVFWXPVUJB
        WWIWXSYQYRYMVKUXQUXRUXSXCUXTYSWJUYAXGYTUYBVHYTUYCUYDYJUYFUYOHUYSUGUYFHX
        AMWUOUYOHSHYDWHHNUYEYFWIYS $.
        $( [22-Jan-2015] $)
    $}

    $( A two-term recurrence for the subfactorial.  This theorem allows us to
       forget the combinatorial definition of the derangement number in favor
       of the recursive definition provided by this theorem and ~ subfac0 ,
       ~ subfac1 .  (Contributed by Mario Carneiro, 23-Jan-2015.) $)
    subfacp1 $p |- ( N e. NN ->
      ( S ` ( N + 1 ) ) = ( N x. ( ( S ` N ) + ( S ` ( N - 1 ) ) ) ) ) $=
      ( vg vz c1 co cv wf1o cfv wne wral wa wceq caddc cfz f1oeq1 fveq2 neeq12d
      cab id cbvralv fveq1 neeq1d ralbidv syl5bb anbi12d cbvabv subfacp1lem6 )
      ABLGLUAMUBMZUPJNZOZKNZUQPZUSQZKUPRZSZJUFCDEFGHIVCUPUPENZOZBNZVDPZVFQZBUPR
      ZSJEUQVDTZURVEVBVIUPUPUQVDUCVBVFUQPZVFQZBUPRVJVIVAVLKBUPUSVFTZUTVKUSVFUSV
      FUQUDVMUGUEUHVJVLVHBUPVJVKVGVFVFUQVDUIUJUKULUMUNUO $.
      $( [23-Jan-2015] $)

    $( A closed-form expression for the subfactorial.  (Contributed by Mario
       Carneiro, 23-Jan-2015.) $)
    subfacval2 $p |- ( N e. NN0 -> ( S ` N ) =
      ( ( ! ` N ) x. sum_ k e. ( 0 ... N ) ( ( -u 1 ^ k ) / ( ! ` k ) ) ) ) $=
      ( wcel cfv cfa cc0 co c1 cmul wceq caddc cc vm cn0 cfz cneg cexp cdiv csu
      cv fveq2 subfac0 syl6eq fac0 oveq2 sumeq1d oveq12d eqeq12d ax-1cn addid2i
      wa oveq1 fveq2d subfac1 fac1 oveq2d anbi12d cz 0z 1re renegcli recni exp0
      ax-mp div1i fsum1 mp2an oveq2i mulid1i eqtr2i wtru nn0uz 0p1e1 exp1 cr cn
      reexpcl mpan faccl nndivre syl2anc recnd adantl pm3.2i a1i negidi fsump1i
      0nn0 trud simpri mul01i wi simpr oveq12 ancoms nn0p1nn subfacp1 syl nn0cn
      cmin pncan sylancl eqtrd cuz peano2nn0 syl6eleq elfznn0 fsump1 nncn fzfid
      fsumcl wne expcl sylancr nnne0 divcl syl3anc adddi id facp1 mulcom oveq1d
      mulass div12 syl112anc divcan3 3eqtrd divcan2 mulcl addass 3eqtr4d eqtr4d
      negsub eqtr3d expp1 add32 eqcomd mulid1 adddir syl5ibr jcad nn0ind simpld
      ) HUBKHDLZHMLZNHUCOZPUDZFUHZUEOZUUPMLZUFOZFUGZQOZRZHPSOZDLZUVCMLZNUVCUCOZ
      UUSFUGZQOZRZAUHZDLZUVJMLZNUVJUCOZUUSFUGZQOZRZUVJPSOZDLZUVQMLZNUVQUCOZUUSF
      UGZQOZRZUSPPNNUCOZUUSFUGZQOZRZNPNPUCOZUUSFUGZQOZRZUSUAUHZDLZUWLMLZNUWLUCO
      ZUUSFUGZQOZRZUWLPSOZDLZUWSMLZNUWSUCOZUUSFUGZQOZRZUSZUXEUWSPSOZDLZUXGMLZNU
      XGUCOZUUSFUGZQOZRZUSUVBUVIUSAUAHUVJNRZUVPUWGUWCUWKUXNUVKPUVOUWFUXNUVKNDLP
      UVJNDUIABCDEGIJUJUKUXNUVLPUVNUWEQUXNUVLNMLZPUVJNMUIULUKUXNUVMUWDUUSFUVJNN
      UCUMUNUOUPUXNUVRNUWBUWJUXNUVRPDLNUXNUVQPDUXNUVQNPSOPUVJNPSUTPUQURUKZVAABC
      DEGIJVBUKUXNUVSPUWAUWIQUXNUVSPMLZPUXNUVQPMUXPVAVCUKUXNUVTUWHUUSFUXNUVQPNU
      CUXPVDUNUOUPVEUVJUWLRZUVPUWRUWCUXEUXRUVKUWMUVOUWQUVJUWLDUIUXRUVLUWNUVNUWP
      QUVJUWLMUIUXRUVMUWOUUSFUVJUWLNUCUMUNUOUPUXRUVRUWTUWBUXDUXRUVQUWSDUVJUWLPS
      UTZVAUXRUVSUXAUWAUXCQUXRUVQUWSMUXSVAUXRUVTUXBUUSFUXRUVQUWSNUCUXSVDUNUOUPV
      EUVJUWSRZUVPUXEUWCUXMUXTUVKUWTUVOUXDUVJUWSDUIUXTUVLUXAUVNUXCQUVJUWSMUIUXT
      UVMUXBUUSFUVJUWSNUCUMUNUOUPUXTUVRUXHUWBUXLUXTUVQUXGDUVJUWSPSUTZVAUXTUVSUX
      IUWAUXKQUXTUVQUXGMUYAVAUXTUVTUXJUUSFUXTUVQUXGNUCUYAVDUNUOUPVEUVJHRZUVPUVB
      UWCUVIUYBUVKUULUVOUVAUVJHDUIUYBUVLUUMUVNUUTQUVJHMUIUYBUVMUUNUUSFUVJHNUCUM
      UNUOUPUYBUVRUVDUWBUVHUYBUVQUVCDUVJHPSUTZVAUYBUVSUVEUWAUVGQUYBUVQUVCMUYCVA
      UYBUVTUVFUUSFUYBUVQUVCNUCUYCVDUNUOUPVEUWGUWKUWFPPQOPUWEPPQNVFKPTKZUWEPRZV
      GUQUUSPFNUUPNRZUUSPPUFOPUYFUUQPUURPUFUYFUUQUUONUEOZPUUPNUUOUEUMUUOTKZUYGP
      RUUOPVHVIZVJZUUOVKVLUKUYFUURUXOPUUPNMUIULUKUOPUQVMUKVNVOZVPPUQVQVRUWJPNQO
      NUWINPQPUBKZUWINRZUYLUYMUSVSUUSUUOPNFNNPUBVTWAUUPPRZUUSUUOPUFOUUOUYNUUQUU
      OUURPUFUYNUUQUUOPUEOZUUOUUPPUUOUEUMUYHUYOUUORUYJUUOWBVLUKUYNUURUXQPUUPPMU
      IVCUKUOUUOUYJVMUKUUPUBKZUUSTKZVSUYPUUSUYPUUQWCKZUURWDKUUSWCKUUOWCKUYPUYRU
      YIUUOUUPWEWFUUPWGUUQUURWHWIWJZWKNUBKZUYEUSVSUYTUYEWPUYKWLWMPUUOSONRVSPUQW
      NWMWOWQWRVPPUQWSVRWLUWLUBKZUXFUXEUXMUXFUXEWTVUAUWRUXEXAWMUXFUXMVUAUWSUWTU
      WMSOZQOZUWSUXDUWQSOZQOZRUXFVUBVUDUWSQUXEUWRVUBVUDRUWTUXDUWMUWQSXBXCVDVUAU
      XHVUCUXLVUEVUAUXHUWSUWTUWSPXHOZDLZSOZQOZVUCVUAUWSWDKZUXHVUIRUWLXDZABCDEGU
      WSIJXEXFVUAVUHVUBUWSQVUAVUGUWMUWTSVUAVUFUWLDVUAUWLTKUYDVUFUWLRUWLXGUQUWLP
      XIXJVAVDVDXKVUAUXLUWSUWNUXGQOZUWPQOZUUOUWSUEOZSOZQOZVUEVUAUXLUXIUXCUUOUXG
      UEOZUXIUFOZSOZQOZUXIUXCQOZUXIVURQOZSOZVUPVUAUXKVUSUXIQVUAUUSVURFNUWSVUAUW
      SUBNXLLZUWLXMZVTXNVUAUUPUXJKZUSUYPUYQVVFUYPVUAUUPUXGXOWKUYSXFUUPUXGRUUQVU
      QUURUXIUFUUPUXGUUOUEUMUUPUXGMUIUOXPVDVUAUXITKZUXCTKVURTKZVUTVVCRVUAUXIWDK
      ZVVGVUAUXGUBKZVVIVUAUWSUBKZVVJVVEUWSXMXFZUXGWGXFZUXIXQXFZVUAUXBUUSFVUANUW
      SXRVUAUUPUXBKZUSUYPUYQVVOUYPVUAUUPUWSXOWKUYSXFZXSVUAVUQTKZVVGUXINXTZVVHVU
      AUYHVVJVVQUYJVVLUUOUXGYAYBZVVNVUAVVIVVRVVMUXIYCXFZVUQUXIYDYEUXIUXCVURYFYE
      VUAVVCUWSVULQOZUWPQOZVUNUXGQOZSOZVUQSOZVWBVWCVUQSOZSOZVUPVUAVVAVWDVVBVUQS
      VUAVVAUXIUWPVUNUXAUFOZSOZQOZUXIUWPQOZUXIVWHQOZSOZVWDVUAUXCVWIUXIQVUAUUSVW
      HFNUWLVUAUWLUBVVDVUAYGVTXNVVPUUPUWSRUUQVUNUURUXAUFUUPUWSUUOUEUMUUPUWSMUIU
      OXPZVDVUAVVGUWPTKZVWHTKZVWJVWMRVVNVUAUWOUUSFVUANUWLXRVUAUUPUWOKZUSUYPUYQV
      WQUYPVUAUUPUWLXOWKUYSXFXSZVUAVUNTKZUXATKZUXANXTZVWPVUAUYHVVKVWSUYJVVEUUOU
      WSYAYBZVUAUXAWDKZVWTVUAVVKVXCVVEUWSWGXFZUXAXQXFZVUAVXCVXAVXDUXAYCXFZVUNUX
      AYDYEZUXIUWPVWHYFYEVUAVWKVWBVWLVWCSVUAUXIVWAUWPQVUAUXIUXAUXGQOZVWAVUAVVKU
      XIVXHRVVEUWSYHXFZVUAVXHUWSUWNQOZUXGQOZVWAVUAUXAVXJUXGQVUAUXAUWNUWSQOZVXJU
      WLYHZVUAUWNTKZUWSTKZVXLVXJRVUAUWNWDKVXNUWLWGUWNXQXFZVUAVUJVXOVUKUWSXQXFZU
      WNUWSYIWIXKYJVUAVXOVXNUXGTKZVXKVWARVXQVXPVUAVVJVXRVVLUXGXGXFZUWSUWNUXGYKY
      EXKXKYJVUAVWLVUNUXIUXAUFOZQOZVWCVUAVVGVWSVWTVXAVWLVYARVVNVXBVXEVXFUXIVUNU
      XAYLYMVUAVXTUXGVUNQVUAVXTVXHUXAUFOZUXGVUAUXIVXHUXAUFVXIYJVUAVXRVWTVXAVYBU
      XGRVXSVXEVXFUXGUXAYNYEXKVDXKUOYOVUAVVQVVGVVRVVBVUQRVVSVVNVVTVUQUXIYPYEUOV
      UAVWBTKZVWCTKZVVQVWEVWGRVUAVWATKZVWOVYCVUAVXOVULTKZVYEVXQVUAVXNVXRVYFVXPV
      XSUWNUXGYQWIZUWSVULYQWIVWRVWAUWPYQWIVUAVWSVXRVYDVXBVXSVUNUXGYQWIVVSVWBVWC
      VUQYRYEVUAVWGUWSVUMQOZUWSVUNQOZSOZVUPVUAVWBVYHVWFVYISVUAVXOVYFVWOVWBVYHRV
      XQVYGVWRUWSVULUWPYKYEVUAVWCVUNUUOQOZSOZVUNUWSQOZVWFVYIVUAVUNUXGUUOSOZQOZV
      YLVYMVUAVWSVXRUYHVYOVYLRVXBVXSUYHVUAUYJWMVUNUXGUUOYFYEVUAVYNUWSVUNQVUAVYN
      UXGPXHOZUWSVUAVXRUYDVYNVYPRVXSUQUXGPUUAXJVUAVXOUYDVYPUWSRVXQUQUWSPXIXJXKV
      DUUBVUAVUQVYKVWCSVUAUYHVVKVUQVYKRUYJVVEUUOUWSUUCYBVDVUAVXOVWSVYIVYMRVXQVX
      BUWSVUNYIWIYSUOVUAVXOVUMTKZVWSVUPVYJRVXQVUAVYFVWOVYQVYGVWRVULUWPYQWIVXBUW
      SVUMVUNYFYEYTYOYOVUAVUDVUOUWSQVUAUXAUWPQOZVUNSOZUWQSOZVYRUWQSOZVUNSOZVUDV
      UOVUAVYRTKZVWSUWQTKZVYTWUBRVUAVWTVWOWUCVXEVWRUXAUWPYQWIVXBVUAVXNVWOWUDVXP
      VWRUWNUWPYQWIVYRVUNUWQUUDYEVUAUXDVYSUWQSVUAUXDUXAVWIQOZVYRUXAVWHQOZSOZVYS
      VUAUXCVWIUXAQVWNVDVUAVWTVWOVWPWUEWUGRVXEVWRVXGUXAUWPVWHYFYEVUAWUFVUNVYRSV
      UAVWSVWTVXAWUFVUNRVXBVXEVXFVUNUXAYPYEVDYOYJVUAVUMWUAVUNSVUAVUMUXAUWNSOZUW
      PQOZWUAVUAVULWUHUWPQVUAVULVXLUWNPQOZSOZWUHVUAVXNVXOUYDVULWUKRVXPVXQUYDVUA
      UQWMUWNUWSPYFYEVUAVXLUXAWUJUWNSVUAUXAVXLVXMUUEVUAVXNWUJUWNRVXPUWNUUFXFUOX
      KYJVUAVWTVXNVWOWUIWUARVXEVXPVWRUXAUWNUWPUUGYEXKYJYSVDYTUPUUHUUIUUJUUK $.
      $( [23-Jan-2015] $)

    $( The subfactorial converges rapidly to ` N ! / _e ` .  (Contributed by
       Mario Carneiro, 23-Jan-2015.) $)
    subfaclim $p |- ( N e. NN ->
      ( abs ` ( ( ( ! ` N ) / _e ) - ( S ` N ) ) ) < ( 1 / N ) ) $=
      ( wcel cfv cdiv co c1 caddc cmul cc syl cc0 wceq vk cfa ceu cmin cabs cn0
      cn cr nnnn0 faccl nncn wne ere recni epos gt0ne0ii divcl mp3an23 ffvelrni
      subfacf nn0cn subcl syl2anc abscl peano2nn nnmulcl nndivre nnrecre cuz cv
      nnre cneg cexp csu cle wbr cmpt eqid ax-1cn negcli a1i ax-mp 1re 0re lt01
      absneg ltleii absid mp2an eqtri leidi eftlub wa nn0uz uztrn2 sylan eftval
      eqbrtri sumeq2dv fveq2d oveq1i cz 1exp syl5eq oveq1d recnd mulid2 3brtr3d
      nnz eqtrd clt wb eftcl mpan cseq cli cdm eftlcvg sylancr eqeltrd eqeltrrd
      isumcl nngt0 lemul2 syl112anc mpbid cfz subfacval2 pncan oveq2d eqtr4d ce
      adantl syl3anc 3eqtrd mulcl eqtr2d nnne0 adddir jca sylancl divrec oveq2i
      sumeq1d df-e efneg efval 3eqtr2i 0nn0 isumsplit fzfid fsumcl adddi subadd
      elfznn0 mpbird absmul nn0ge0 mulass divcan5 syl122anc divass 3eqtr3d ltp1
      facp1 3brtr4d addass oveq12d 3eqtr4d breqtrrd lt2mul2div syl22anc lelttrd
      id mulcom ) GUGJZGUBKZUCLMZGDKZUDMZUEKZGNOMZNOMZUWBUWBPMZLMZNGLMZUVPUVTQJ
      ZUWAUHJUVPUVRQJZUVSQJZUWGUVPUVQQJZUWHUVPUVQUGJZUWJUVPGUFJZUWKGUIZGUJRZUVQ
      UKRZUWJUCQJZUCSULZUWHUCUMUNZUCUMUOUPZUVQUCUQURRZUVPUVSUFJZUWIUVPUWLUXAUWM
      UFUFGDABCDEFHIUTUSRUVSVARZUVRUVSVBVCUVTVDRUVPUWCUHJZUWDUGJZUWEUHJUVPUWCUG
      JZUXCUVPUWBUGJZUXEGVEZUWBVERZUWCVKRZUVPUXFUXFUXDUXGUXGUWBUWBVFVCZUWCUWDVG
      VCGVHUVPUVQUWBVIKZNVLZUAVJZVMMUXMUBKLMZUAVNZUEKZPMZUVQUWCUWBUBKZUWBPMZLMZ
      PMZUWAUWEVOUVPUXPUXTVOVPZUXQUYAVOVPZUVPUXKUXMFUFUXLFVJZVMMUYDUBKZLMVQZKZU
      AVNZUEKZUXLUEKZUWBVMMZUXTPMZUXPUXTVOUVPUXLUAFUYFFUFUYJUYDVMMUYELMVQZFUFUY
      KUXRLMNUWCLMUYDVMMPMVQZUWBUYFVRZUYMVRUYNVRUXGUXLQJZUVPNVSVTZWAUYJNVOVPUVP
      UYJNNVOUYJNUEKZNNQJZUYJUYRTVSNWFWBNUHJZSNVOVPUYRNTWCSNWDWCWEWGNWHWIWJZNWC
      WKWRWAWLUVPUYHUXOUEUVPUXKUYGUXNUAUVPUXMUXKJZWMZUXMUFJZUYGUXNTZUVPUWBUFJZV
      UBVUDUVPUXFVUFUXGUWBUIRZSUXMUWBUFWNWOWPZUXLFUYFUXMUYOWQZRZWSZWTZUVPUYLNUX
      TPMZUXTUVPUYKNUXTPUVPUYKNUWBVMMZNUYJNUWBVMVUAXAUVPUWBXBJZVUNNTUVPUXFVUOUX
      GUWBXIRZUWBXCRXDXEUVPUXTQJVUMUXTTUVPUXTUVPUXCUXSUGJZUXTUHJZUXIUVPUXRUGJZU
      XFVUQUVPVUFVUSVUGUWBUJRUXGUXRUWBVFVCZUWCUXSVGVCZXFUXTXGRXJXHUVPUXPUHJVURU
      VQUHJZSUVQXKVPZUYBUYCXLUVPUYIUXPUHVULUVPUYHQJUYIUHJUVPUYHUXOQVUKUVPUXNUAU
      YFUWBUXKUXKVRZVUPVUJVUCVUDUXNQJZVUHUYPVUDVVEUYQUXLUXMXMZXNZRUVPUYPVUFOUYF
      UWBXOXPXQZJUYQVUGUXLFUYFUWBUYOXRXSYBZXTUYHVDRYAVVAUVPUWKVVBUWNUVQVKRZUVPU
      WKVVCUWNUVQYCRUXPUXTUVQYDYEYFUVPUWAUVQUXOPMZUEKZUVQUEKZUXPPMZUXQUVPUVTVVK
      UEUVPUVTVVKTZUVSVVKOMZUVRTZUVPVVPUVQSUWBNUDMZYGMZUXNUAVNZPMZVVKOMZUVRUVPU
      VSVWAVVKOUVPUVSUVQSGYGMZUXNUAVNZPMZVWAUVPUWLUVSVWETUWMABCDEUAFGHIYHRUVPVV
      TVWDUVQPUVPVVSVWCUXNUAUVPVVRGSYGUVPGQJZUYSVVRGTGUKZVSGNYIUUAYJUUDYJYKXEUV
      PUVRUVQNUCLMZPMZUVQVVTUXOOMZPMZVWBUVPUWJUVRVWITZUWOUWJUWPUWQVWLUWRUWSUVQU
      CUUBURRUVPVWHVWJUVQPUVPVWHUFUXNUAVNZVWJVWHNNYLKZLMZUXLYLKZVWMUCVWNNLUUEUU
      CUYSVWPVWOTVSNUUFWBUYPVWPVWMTUYQUXLUAUUGWBUUHUVPUXNUAUYFSUWBUXKUFWNVVDVUG
      VUDVUEUVPVUIYMVUDVVEUVPVVGYMOUYFSXOVVHJZUVPUYPSUFJVWQUYQUUIUXLFUYFSUYOXRW
      IWAUUJXDYJUVPUWJVVTQJUXOQJZVWKVWBTUWOUVPVVSUXNUAUVPSVVRUUKUVPUXMVVSJZWMUY
      PVUDVVEUYQVWSVUDUVPUXMVVRUUOYMVVFXSUULVVIUVQVVTUXOUUMYNYOYKUVPUWHUWIVVKQJ
      ZVVOVVQXLUWTUXBUVPUWJVWRVWTUWOVVIUVQUXOYPVCUVRUVSVVKUUNYNUUPWTUVPUWJVWRVV
      LVVNTUWOVVIUVQUXOUUQVCUVPVVMUVQUXPPUVPVVBSUVQVOVPZVVMUVQTVVJUVPUVQUFJZVXA
      UVPUWKVXBUWNUVQUIRUVQUURRUVQWHVCXEYOUVPUVQUWCPMZUVQUWDPMZLMZVXCUXSLMZUWEU
      YAUVPVXDUXSVXCLUVPUXSUVQUWBPMZUWBPMZVXDUVPUXRVXGUWBPUVPUWLUXRVXGTUWMGUVER
      XEUVPUWJUWBQJZVXIVXHVXDTUWOUVPUXFVXIUXGUWBUKRZVXJUVQUWBUWBUUSYNYQYJUVPUWC
      QJZUWDQJZUWDSULZUWJUVQSULZVXEUWETUVPUWCUXIXFZUVPUXDVXLUXJUWDUKRZUVPUXDVXM
      UXJUWDYRRUWOUVPUWKVXNUWNUVQYRRUWCUWDUVQUUTUVAUVPUWJVXKUXSQJZUXSSULZVXFUYA
      TUWOVXOUVPVUQVXQVUTUXSUKRUVPVUQVXRVUTUXSYRRUVQUWCUXSUVBYEUVCUVFUVPUWCGPMZ
      NUWDPMZXKVPZUWEUWFXKVPZUVPVXSVXSNOMZVXTXKUVPVXSUHJZVXSVYCXKVPUVPVXSUGJZVY
      DUVPUXEUVPVYEUXHUVPUVNUWCGVFVCVXSVKRVXSUVDRUVPVXTUWDGUWBPMZNUWBPMZOMZVYCU
      VPVXLVXTUWDTVXPUWDXGRUVPVWFUYSVXIUWDVYHTVWGUYSUVPVSWAZVXJGNUWBYSYNUVPUWBG
      PMZUWBOMZVYJNGPMZOMZNOMZVYHVYCUVPVYNVYJGOMZNOMZVYKUVPVYMVYONOUVPVYLGVYJOU
      VPVWFVYLGTVWGGXGRYJXEUVPVYJQJZVWFUYSVYPVYKTUVPVXIVWFVYQVXJVWGUWBGYPVCVWGV
      YIVYJGNUVGYNYQUVPVYFVYJVYGUWBOUVPVWFVXIVYFVYJTVWGVXJGUWBUVOVCUVPVXIVYGUWB
      TVXJUWBXGRUVHUVPVXSVYMNOUVPVXIUYSVWFVXSVYMTVXJVYIVWGUWBNGYSYNXEUVIYOUVJUV
      PUXCGUHJZSGXKVPZWMUYTUWDUHJZSUWDXKVPZWMZVYAVYBXLUXIUVPVYRVYSGVKGYCYTUYTUV
      PWCWAUVPUXDWUBUXJUXDVYTWUAUWDVKUWDYCYTRUWCGNUWDUVKUVLYFUVM $.
      $( [23-Jan-2015] $)

    $( Another closed form expression for the subfactorial.  The expression
       ` |_ `` ( x + 1 / 2 ) ` is a way of saying "rounded to the nearest
       integer".  (Contributed by Mario Carneiro, 23-Jan-2015.) $)
    subfacval3 $p |- ( N e. NN -> ( S ` N ) =
      ( |_ ` ( ( ( ! ` N ) / _e ) + ( 1 / 2 ) ) ) ) $=
      ( wcel cfv ceu co c1 c2 caddc wbr clt cc0 cr cn cfa cdiv cfl wceq cmin wa
      cle cabs cuz wo elnn1uz2 fveq2 fac1 syl6eq oveq1d subfac1 oveq12d crp epr
      rpreccl ax-mp rpre recni subid1i fveq2d rpge0 absid c3 egt2lt3 simpli 2re
      mp2an ere 2pos epos ltrecii mpbi syl6eqbr eluz2b2 simplbi cn0 nnnn0 faccl
      nnre 3syl rerpdivcl sylancl subfacf ffvelrni nn0z zre syl resubcl syl2anc
      cc cz recnd abscl nnrecre 1re rehalfcl a1i subfaclim eluzle nngt0 mpanl12
      wb lerec mpbid ltletrd jaoi absdiflt syl3anc simpld ltsubadd readdcl ltle
      sylbi wi mpd simprd ltadd1 addass ax-1cn 2halves oveq2i breqtrd mpbir2and
      flbi eqcomd ) GUAJZGUBKZLUCMZNOUCMZPMZUDKZGDKZYLYQYRUEZYRYPUHQZYPYRNPMZRQ
      ZYLYRYPRQZYTYLYRYOUFMYNRQZUUCYLUUDYNYRYOPMZRQZYLYNYRUFMZUIKZYORQZUUDUUFUG
      ZYLGNUEZGOUJKJZUKUUIGULUUKUUIUULUUKUUHNLUCMZYORUUKUUHUUMUIKZUUMUUKUUGUUMU
      IUUKUUGUUMSUFMUUMUUKYNUUMYRSUFUUKYMNLUCUUKYMNUBKNGNUBUMUNUOUPUUKYRNDKSGND
      UMABCDEFHIUQUOURUUMUUMUUMUSJZUUMTJZLUSJZUUOUTLVAVBZUUMVCVBZVDVEUOVFUUPSUU
      MUHQZUUNUUMUEUUSUUOUUTUURUUMVGVBUUMVHVMUOOLRQZUUMYORQUVALVIRQVJVKOLVLVNVO
      VPVQVRVSUULUUHNGUCMZYOUULYLUUHTJZUULYLNGRQGVTWAZYLUUGWPJUVCYLUUGYLYNTJZYR
      TJZUUGTJYLYMTJZUUQUVEYLGWBJZYMUAJUVGGWCZGWDYMWEWFUTYMLWGWHZYLYRWQJZUVFYLU
      VHYRWBJUVKUVIWBWBGDABCDEFHIWIWJYRWKWFZYRWLWMZYNYRWNWOWRUUGWSWMWMUULYLUVBT
      JUVDGWTWMYOTJZUULNTJUVNXANXBVBZXCUULYLUUHUVBRQUVDABCDEFGHIXDWMUULOGUHQZUV
      BYOUHQZOGXEUULYLUVPUVQXHZUVDYLGTJZSGRQZUVRGWEGXFOTJSORQUVSUVTUGUVRVLVOOGX
      IXGWOWMXJXKXLXSYLUVEUVFUVNUUIUUJXHUVJUVMUVNYLUVOXCZYNYRYOXMXNXJZXOYLUVFUV
      NUVEUUDUUCXHUVMUWAUVJYRYOYNXPXNXJYLUVFYPTJZUUCYTXTUVMYLUVEUVNUWCUVJUVOYNY
      OXQWHZYRYPXRWOYAYLYPUUEYOPMZUUARYLUUFYPUWERQZYLUUDUUFUWBYBYLUVEUUETJZUVNU
      UFUWFXHUVJYLUVFUVNUWGUVMUVOYRYOXQWHUWAYNUUEYOYCXNXJYLUWEYRYOYOPMZPMZUUAYL
      YRWPJYOWPJZUWJUWEUWIUEYLYRUVMWRYLYOUWAWRZUWKYRYOYOYDXNUWHNYRPNWPJUWHNUEYE
      NYFVBYGUOYHYLUWCUVKYSYTUUBUGXHUWDUVLYPYRYJWOYIYK $.
      $( [23-Jan-2015] $)
  $}

  ${
    $d f m x y A $.  $d m n x y D $.
    derangfmla.d $e |- D = ( x e. Fin |-> ( # ` { f | ( f : x -1-1-onto-> x /\
      A. y e. x ( f ` y ) =/= y ) } ) ) $.
    $( The derangements formula, which expresses the number of derangements of
       a finite nonempty set in terms of the factorial.  The expression
       ` |_ `` ( x + 1 / 2 ) ` is a way of saying "rounded to the nearest
       integer".  (Contributed by Mario Carneiro, 23-Jan-2015.) $)
    derangfmla $p |- ( ( A e. Fin /\ A =/= (/) ) ->
      ( D ` A ) = ( |_ ` ( ( ( ! ` ( # ` A ) ) / _e ) + ( 1 / 2 ) ) ) ) $=
      ( vn vm cfn wcel c0 wne cfv cn0 c1 cv cfz co cdiv wceq chash cmpt cfa ceu
      wa c2 caddc cfl oveq2 fveq2d cbvmptv derangen2 adantr cn hashnncl biimpar
      subfacval3 syl eqtrd ) CIJZCKLZUEZCDMZCUAMZGNOGPZQRZDMZUBZMZVDUCMUDSROUFS
      RUGRUHMZUTVCVITVAABCDVHEHFGHNVGOHPZQRZDMVEVKTVFVLDVEVKOQUIUJUKZULUMVBVDUN
      JZVIVJTUTVNVACUOUPABDVHEHVDFVMUQURUS $.
      $( [23-Jan-2015] $)
  $}

