$(
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                           Pocklington's theorem
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
$)

  $(
  @{
    @( The binomial coefficient takes its maximum value at the center. @)
    binomctr @p |- ( ( N e. NN0 /\ K e. ZZ ) ->
                     ( N _C K ) <_ ( N _C ( |_ ` ( N / 2 ) ) ) ) @=
      ? @.
  @}

  @{
    @( A bound on the binomial coefficient. @)
    binombnd @p |- ( N e. NN0 ->
                     ( ( 4 ^ N ) / ( 2 x. N ) ) <_ ( ( 2 x. N ) _C N ) ) @=
      ? @.
  @}
  $)

  ${
    $d x z P $.
    $( One need only check prime divisors of ` P ` up to ` sqr P ` in order to
       ensure primality.  (Contributed by Mario Carneiro, 18-Feb-2014.) $)
    isprm5 $p |- ( P e. Prime <-> ( P e. ( ZZ>= ` 2 ) /\
                    A. z e. Prime ( ( z ^ 2 ) <_ P -> -. z || P ) ) ) $=
      ( cprime wcel c2 wbr wceq wi wa co cle wn cmul clt c1 cr cc0 syl syl11anc
      syl111anc vx cuz cfv cdivides wral cexp isprm4 prmuz2 a1i eluz2b2 simprbi
      cv cn wb eluzelre simplbi nngt0 ltmulgt11 ax-mulrcl opreq12 anidms breq1d
      mpbid ltnle notbid syl5ibrcom imim2d con2 imim12d ralimdv2 annim ad2antlr
      syl6 wrex wo ad2antrr letric breq1 anbi12d rcla4ev ancom2s expr ad2ant2lr
      cdiv crp simplr nnmulcl nnrp rpdivcl syl2an elrp sylib lemul1 recnd nnne0
      cc wne divmuldiv syl22anc nncn divass eqtrd divcan2 eqcomd breq12d bitr4d
      jca biimpd eluzelz simprl divides2 dvds0lem syl31anc jctird mulid2 dvdsle
      cz ltlen imp syl21anc simprr sylibr necomd mpbir2and eqbrtrd 1re zre nnre
      df-ne ltmuldiv mpd ex rexlimdva ad2antrl remulcl nnnn0 nn0ge0 3syl rexnal
      cn0 eluz2b1 sylanbrc jaod syl5bir exprmfct prmz simpllr ad3antrrr simplrl
      jctild le2msq letrd simplrr dvdstr mp2and df-an syld 3imtr3g con4d impbid
      reximdva prmnn sqval imbi1d ralbiia syl6bbr pm5.32i bitri ) BCDBEUBUCZDZA
      ULZBUDFZUVKBGZHZAUVIUEZIUVJUVKEUFJZBKFZUVLLZHZACUEZIABUGUVJUVOUVTUVJUVOUV
      KUVKMJZBKFZUVRHZACUEZUVTUVJUVOUWDUVJUVNUWCAUVICUVJUVKCDZUVKUVIDZUVNUWCUWE
      UWFHUVJUVKUHZUIUVJUVNUVLUWBLZHUWCUVJUVMUWHUVLUVJUWHUVMBBMJZBKFZLZUVJBUWIN
      FZUWKUVJOBNFZUWLUVJBUMDZUWMBUJZUKUVJBPDZUWPQBNFZUWMUWLUNEBUOZUWRUVJUWNUWQ
      UVJUWNUWMUWOUPZBUQRBBURTVCUVJUWPUWIPDZUWLUWKUNUWRUVJUWPUWPUWTUWRUWRBBUSSB
      UWIVDSVCUVMUWBUWJUVMUWAUWIBKUVMUWAUWIGUVKBUVKBMUTVAVBVEVFVGUVLUWBVHVMVIVJ
      UVJUVOUWDUVJUVNLZAUVIVNZUWCLZACVNZUVOLUWDLUVJUXBUAULZUXEMJZBKFZUXEBUDFZIZ
      UAUVIVNZUXDUVJUXAUXJAUVIUXAUVLUVMLZIZUVJUWFIZUXJUVLUVMVKUXMUXLUXJUXMUXLIZ
      UWBBUWAKFZVOZUXJUXNUWAPDZUWPUXPUXNUVKPDZUXRUXQUWFUXRUVJUXLEUVKUOVLZUXSUVK
      UVKUSSZUVJUWPUWFUXLUWRVPZUWABVQSUXNUWBUXJUXOUWFUVLUWBUXJHUVJUXKUWFUVLUWBU
      XJUWFUWBUVLUXJUXIUWBUVLIZUAUVKUVIUXEUVKGZUXGUWBUXHUVLUYCUXFUWABKUYCUXFUWA
      GUXEUVKUXEUVKMUTVAVBUXEUVKBUDVRVSVTWAWBWCUXNUXOBUVKWDJZUVIDZUYDUYDMJZBKFZ
      UYDBUDFZIZIUXJUXNUXOUYIUYEUXNUXOUYGUYHUXNUXOUYGUXNUXOBBUWAWDJZMJZUWAUYJMJ
      ZKFZUYGUXNUWPUXQUYJPDQUYJNFIZUXOUYMUNUYAUXTUXNUYJWEDZUYNUXNUWNUWAUMDZUYOU
      VJUWNUWFUXLUWSVPZUXNUVKUMDZUYRUYPUXNUWFUYRUVJUWFUXLWFUWFUYROUVKNFUVKUJUPZ
      RZUYTUVKUVKWGSZUWNBWEDUWAWEDUYOUYPBWHUWAWHBUWAWIWJSUYJWKWLBUWAUYJWMTUXNUY
      FUYKBUYLKUXNUYFUWIUWAWDJZUYKUXNBWPDZVUCUVKWPDZUVKQWQZIZVUFUYFVUBGUXNBUYAW
      NZVUGUXNVUDVUEUXNUVKUXSWNZUXNUYRVUEUYTUVKWORZXGZVUJBBUVKUVKWRWSUXNVUCVUCU
      WAWPDZUWAQWQZIVUBUYKGVUGVUGUXNVUKVULUXNUYPVUKVUAUWAWTRZUXNUYPVULVUAUWAWOR
      ZXGBBUWAXATXBUXNUYLBUXNVUCVUKVULUYLBGVUGVUMVUNBUWAXCTXDXEXFXHUXNUVKXQDZUY
      DXQDZBXQDZUVKUYDMJBGZUYHUWFVUOUVJUXLEUVKXIVLZUXNUVLVUPUXMUVLUXKXJZUXNVUOV
      UEVUQUVLVUPUNVUSVUIUVJVUQUWFUXLEBXIZVPZUVKBXKTVCZVVBUXNVUCVUDVUEVURVUGVUH
      VUIBUVKXCTUVKUYDBXLXMXNUXNVUPOUYDNFZUYEVVCUXNOUVKMJZBNFZVVDUXNVVEUVKBNUXN
      VUDVVEUVKGVUHUVKXORUXNUVKBNFZUVKBKFZBUVKWQZUXNUXRUWPVVGVVHVVIIUNUXSUYAUVK
      BXRSUXNVUOUWNUVLVVHVUSUYQVUTVUOUWNIUVLVVHUVKBXPXSXTUXNUVKBUXNUXKUVKBWQUXM
      UVLUXKYAUVKBYIYBYCYDYEUXNOPDZUWPUXRQUVKNFZIZVVFVVDUNVVJUXNYFUIUXNVUQUWPVV
      BBYGZRUXNUYRVVLUYTUYRUXRVVKUVKYHUVKUQXGROBUVKYJTVCUYDUUAUUBUUJUXIUYIUAUYD
      UVIUXEUYDGZUXGUYGUXHUYHVVNUXFUYFBKVVNUXFUYFGUXEUYDUXEUYDMUTVAVBUXEUYDBUDV
      RVSVTVMUUCYKYLUUDYMUVJUXIUXDUAUVIUVJUXEUVIDZIZUXIUXDVVPUXIIZUVKUXEUDFZACV
      NZUXDVVOVVSUVJUXIUXEAUUEVLVVQVVRUXCACVVQUWEVVRUXCVVQUWEVVRIZIZUYBUXCVWAUW
      BUVLVWAUWAUXFBVWAUXRUXRUXQVWAVUOUXRUWEVUOVVQVVRUVKUUFYNZUVKYGRZVWCUVKUVKY
      OSVWAUXEPDZVWDUXFPDVWAUXEXQDZVWDVWAVVOVWEUVJVVOUXIVVTUUGZEUXEXIRZUXEYGRZV
      WHUXEUXEYOSVWAVUQUWPUVJVUQVVOUXIVVTVVAUUHZVVMRVWAUVKUXEKFZUWAUXFKFZVWAVUO
      UXEUMDZVVRVWJVWBVWAVVOVWLVWFVVOVWLOUXENFUXEUJUPRZVVQUWEVVRYAZVUOVWLIVVRVW
      JUVKUXEXPXSXTVWAUXRQUVKKFZVWDQUXEKFZVWJVWKUNVWCUWEVWOVVQVVRUWEUWFVWOUWGUW
      FUYRUVKYTDVWOUYSUVKYPUVKYQYRRYNVWHVWAVWLVWPVWMVWLUXEYTDVWPUXEYPUXEYQRRUVK
      UXEUUKWSVCVVPUXGUXHVVTUUIUULVWAVVRUXHUVLVWNVVPUXGUXHVVTUUMVWAVUOVWEVUQVVR
      UXHIUVLHVWBVWGVWIUVKUXEBUUNTUUOXGUWBUVLUUPWLWBUVAYKYLYMUUQUVNAUVIYSUWCACY
      SUURUUSUUTUVSUWCACUWEUVQUWBUVRUWEUVPUWABKUWEUYRVUDUVPUWAGUVKUVBUVKWTUVKUV
      CYRVBUVDUVEUVFUVGUVH $.
      $( [18-Feb-2014] $)
  $}

  ${
    ndvdsi.1 $e |- A e. NN $.
    ndvdsi.2 $e |- Q e. NN0 $.
    ndvdsi.3 $e |- R e. NN $.
    ndvdsi.4 $e |- B = ( ( A x. Q ) + R ) $.
    ndvdsi.5 $e |- R < A $.
    $( A quick test for non-divisibility.  (Contributed by Mario Carneiro,
       18-Feb-2014.) $)
    ndvdsi $p |- -. A || B $=
      ( cdivides wbr cmul co caddc wn cz wcel cn ax-mp mp2an nnz cn0 nn0z wa wi
      dvdsmul1 clt zmulcl pm3.2i ndvdsadd mp3an breq2i mtbir ) ABJKAACLMZDNMZJK
      ZAUNJKZUPOZAPQZCPQZUQARQZUSEAUASZCUBQUTFCUCSZACUFTUNPQZVADRQZDAUGKZUDUQUR
      UEUSUTVDVBVCACUHTEVEVFGIUIADUNUJUKSBUOAJHULUM $.
      $( [18-Feb-2014] $)
  $}

  $(
  @{
    @( A relation involving divisibility by a prime power. @)
    prmpwdiv @p |- ( ( ( K e. ZZ /\ D e. ZZ ) /\ ( P e. Prime /\ N e. NN0 ) /\
         ( D || ( K x. ( P ^ N ) ) /\ -. D || ( K x. ( P ^ ( N - 1 ) ) ) ) ) ->
                   ( P ^ N ) || D ) @=
      ? @.
  @}

  @{
    @( The factorial of a number only contains primes less than the base. @)
    prmfac1 @p |- ( ( P e. Prime /\ N e. NN0 /\ P || ( ! ` N ) ) -> P <_ N ) @=
      ? @.
  @}

  @{
    pockthg.1 @e |- ( ph -> A e. NN ) @.
    pockthg.2 @e |- ( ph -> B e. NN ) @.
    pockthg.3 @e |- ( ph -> B < A ) @.
    pockthg.4 @e |- ( ph -> N = ( ( A x. B ) + 1 ) ) @.
    @{
      pockthlem.5 @e |- ( ph -> P e. Prime ) @.
      pockthlem.6 @e |- ( ph -> P || N ) @.
      @{
        pockthlem.7 @e |- ( ph -> Q e. Prime ) @.
        pockthlem.8 @e |- ( ph -> Q || A ) @.
        pockthlem.9 @e |- ( ph -> C e. NN ) @.
        pockthlem.10 @e |- ( ph -> ( ( C ^ ( N - 1 ) ) mod N ) = 1 ) @.
        pockthlem.11 @e |- ( ph ->
                            ( ( ( C ^ ( ( N - 1 ) / Q ) ) - 1 ) gcd N ) = 1 ) @.
        @( Lemma for ~ pockthg .  @)
        pockthlem1 @p |- ( ph -> ( Q pCnt A ) <_ ( Q pCnt ( P - 1 ) ) ) @=
          ? @.
      @}
    @}
    @( The generalized Pocklington's theorem. If ` N - 1 = A x. B ` where
       ` B < A ` , then ` N ` is prime if and only if for every prime factor
       ` p ` of ` A ` , there is an ` x ` such that
       ` x ^ ( N - 1 ) = 1 ( mod N ) ` and
       ` gcd ( x ^ ( ( N - 1 ) / p ) - 1 , N ) = 1 ` .  @)
    pockthg @p |- ( ph -> ( N e. Prime <-> A. p e. Prime ( p || A -> E. x e. NN
                   ( ( ( x ^ ( N - 1 ) ) mod N ) = 1 /\
                     ( ( ( x ^ ( ( N - 1 ) / p ) ) - 1 ) gcd N ) = 1 ) ) ) ) @=
      ? @.
  @}

  @{
    pockthi.p @e |- P e. Prime @.
    pockthi.g @e |- G e. NN @.
    pockthi.m @e |- M = ( G x. P ) @.
    pockthi.n @e |- N = ( M + 1 ) @.
    pockthi.d @e |- D e. NN @.
    pockthi.e @e |- E e. NN @.
    pockthi.a @e |- A e. NN @.
    pockthi.fac @e |- M = ( D x. ( P ^ E ) ) @.
    pockthi.gt @e |- D < ( P ^ E ) @.
    pockthi.mod @e |- ( ( A ^ M ) mod N ) = 1 @.
    pockthi.gcd @e |- ( ( ( A ^ G ) - 1 ) gcd N ) = 1 @.
    @( Pocklington's theorem, which gives a sufficient criterion for a number
       ` N ` to be prime. This is the preferred method for verifying large
       primes, being much more efficient to compute than trial division. This
       form has been optimized for application to specific large primes; see
       ~ pockthg for a more general closed-form version. @)
    pockthi @p |- N e. Prime @=
      ( co c1 vy vx cn wcel cprime cexp cn0 prmnn ax-mp nnnn0i nnexpcl mp2an id
      a1i clt wbr cmul caddc wceq nncni mulcomi eqtri opreq1i cdivides cmin cmo
      cv cdiv cgcd wa wrex wi wral prmdvdsexpb mp3an23 eqcomi nnmulcli peano2nn
      eqeltri ax-1cn subadd2i mpbir opreq2i opreq2 3eqtrri subcli nnne0i syl6eq
      divmuli opreq2d opreq1d eqeq1d mpbiri opreq1 anbi12d rcla4ev mpan sylancr
      wb syl6bi rgen pockthg ) BUCUDZGUEUDLXCUACDUFSZBGUBXDUCUDZXCCUCUDZDUGUDXE
      CUEUDZXFHCUHUIZDMUJCDUKULZUNXCUMBXDUOUPXCPUNGXDBUQSZTURSZUSXCGFTURSZXKKFX
      JTURFBXDUQSXJOBXDBLUTXDXIUTVAVBVCVBUNUBVGZXDVDUPZUAVGZGTVESZUFSZGVFSZTUSZ
      XOXPXMVHSZUFSZTVESZGVISZTUSZVJZUAUCVKZVLZUBUEVMXCYGUBUEXMUEUDZXNXMCUSZYFY
      HXGDUCUDXNYIWSHMXMCDVNVOYIAXPUFSZGVFSZTUSZAXTUFSZTVESZGVISZTUSZYFYKAFUFSZ
      GVFSTYJYQGVFXPFAUFXPFUSXLGUSGXLKVPGTFGGXLUCKFUCUDXLUCUDFECUQSZUCJECIXHVQV
      SZFVRUIVSUTZVTFYSUTWAWBZWCVCQVBYIYPAEUFSZTVESZGVISZTUSRYIYOUUDTYIYNUUCGVI
      YIYMUUBTVEYIXTEAUFYIXTXPCVHSZEXMCXPVHWDUUEEUSCEUQSZXPUSXPFYRUUFUUAJECEIUT
      ZCXHUTZVAWEXPCEGTYTVTWFUUHUUGCXHWGWIWBWHWJWKWKWLWMAUCUDYLYPVJZYFNYEUUIUAA
      UCXOAUSZXSYLYDYPUUJXRYKTUUJXQYJGVFXOAXPUFWNWKWLUUJYCYOTUUJYBYNGVIUUJYAYMT
      VEXOAXTUFWNWKWKWLWOWPWQWRWTXAUNXBUI @.
  @}
  $)

  ${
    $d x A $.  $d x N $.
    nprmi.1 $e |- A e. NN $.
    nprmi.2 $e |- B e. NN $.
    nprmi.3 $e |- 1 < A $.
    nprmi.4 $e |- 1 < B $.
    nprmi.5 $e |- N = ( A x. B ) $.
    $( An inference for compositeness.  (Contributed by Mario Carneiro,
       18-Feb-2014.) $)
    nprmi $p |- -. N e. Prime $=
      ( vx cdivides wbr wceq wcel wn cn c1 clt cz nnz nnrei cv wi c2 cuz cprime
      cfv wral wrex wa eluz2b2 mpbir2an cmul nnmulcli eqeltri w3a nncni mulcomi
      co eqtr4i dvds0lem mpan2 syl3an mp3an wne cr cc0 wb nngt0i ltmulgt11 mpbi
      ltneii necomi df-ne pm3.2i breq1 eqeq1 imbi12d notbid annim syl6bbr mp2an
      breqtrri rcla4ev rexnal mulgt1 mp4an biantrur isprm4 bitr4i mtbi ) IUAZCJ
      KZWKCLZUBZIUCUDUFZUGZCUEMZWNNZIWOUHZWPNAWOMZACJKZACLZNZUIZWSWTAOMZPAQKZAU
      JDFUKXAXCBOMZXECOMZXAEDCABULURZOHABDEUMZUNZXGBRMZXEARMZXHCRMZXABSASCSXLXM
      XNUOBAULURZCLXAXOXICBABEUPADUPUQHUSBACUTVAVBVCACVDXCCAACADTZCXKTAXICQPBQK
      ZAXIQKZGAVEMZBVEMZVFAQKXQXRVGXPBETZADVHABVIVCVJHWBVKVLACVMVJVNWRXDIAWOWKA
      LZWRXAXBUBZNXDYBWNYCYBWLXAWMXBWKACJVOWKACVPVQVRXAXBVSVTWCWAWNIWOWDVJWPCWO
      MZWPUIWQYDWPCXIWOHXIWOMXIOMPXIQKZXIUJXJXSXTXFXQYEXPYAFGABWEWFUKUNWGICWHWI
      WJ $.
      $( [18-Feb-2014] $)
  $}

